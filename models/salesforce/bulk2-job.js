const a25_0x216274=a25_0x29a5;function a25_0x29a5(_0x57598a,_0x4954d6){const _0x3abd8b=a25_0x3abd();return a25_0x29a5=function(_0x29a53a,_0x2e85bb){_0x29a53a=_0x29a53a-0x88;let _0x39330d=_0x3abd8b[_0x29a53a];return _0x39330d;},a25_0x29a5(_0x57598a,_0x4954d6);}(function(_0x94ea1b,_0x29e97e){const _0x59e6d2=a25_0x29a5,_0x880d1d=_0x94ea1b();while(!![]){try{const _0xfd2a95=-parseInt(_0x59e6d2(0x8a))/0x1*(parseInt(_0x59e6d2(0x108))/0x2)+-parseInt(_0x59e6d2(0xa6))/0x3+-parseInt(_0x59e6d2(0xdf))/0x4*(-parseInt(_0x59e6d2(0xa4))/0x5)+-parseInt(_0x59e6d2(0xd8))/0x6*(parseInt(_0x59e6d2(0xd6))/0x7)+parseInt(_0x59e6d2(0xbb))/0x8+-parseInt(_0x59e6d2(0xfc))/0x9*(parseInt(_0x59e6d2(0xed))/0xa)+parseInt(_0x59e6d2(0xe5))/0xb*(parseInt(_0x59e6d2(0xba))/0xc);if(_0xfd2a95===_0x29e97e)break;else _0x880d1d['push'](_0x880d1d['shift']());}catch(_0x43408a){_0x880d1d['push'](_0x880d1d['shift']());}}}(a25_0x3abd,0x1e50f));const requiredParam=require(a25_0x216274(0xf7)),SFAxiosWrapper=require(a25_0x216274(0x105)),settings=require(a25_0x216274(0x99)),{objectToSfCsv,sfCsvToObject,objectToSfCsvStream}=require(a25_0x216274(0x98)),{uploadData}=require(a25_0x216274(0x101)),sleep=require('../../utils/sleep'),loginUrl=process[a25_0x216274(0xae)][a25_0x216274(0xa9)],instanceUrl=process[a25_0x216274(0xae)][a25_0x216274(0xde)],clientId=process[a25_0x216274(0xae)][a25_0x216274(0x9a)],refreshToken=process[a25_0x216274(0xae)][a25_0x216274(0xcd)];function a25_0x3abd(){const _0x3e6043=['Open','===\x20Uploading\x20job\x20csv...','getJobInfo','coercedToStandardDelete','get','getSuccessfulResults','sf__Id','random','./sf-csv-utils','../../settings','SF_CLIENT_ID','===\x20Closing\x20job...','response','upsert','externalIdFieldName','FORCE_BULK_RESULT_REMOVALS_TEST','Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:\x20','exports','pollingMs',',\x20STATE:\x20','621690kpMxSN','patch','302379hFxDpA','message','join','SF_LOGIN_URL','put','Error\x20creating\x20bulk\x20data\x20load\x20job:\x20','uploadJobData','includes','env','uploadJobdataStream','\x20seconds\x20on\x20OBJECT:\x20','data','stringify','log','push','failedResults','getResults','Error\x20deleting\x20bulk\x20data\x20load\x20job:','hardDelete','getFailedResults','408dtjwXo','1811696ytGykz','split','First\x205\x20lines\x20of\x20csv\x20data\x20(incl\x20header):\x0a','closeJob','state','Row\x20was\x20missing\x20sfid\x20in\x20the\x20objArr.','InProgress','pollingTimeoutMs','abortComplete','getTime','Bulk\x20data\x20load\x20job\x20is\x20still\x20open\x20after\x20attempting\x20to\x20mark\x20it\x20upload\x20closed.\x20This\x20should\x20not\x20happen.','getAllResults','Aborted','/batches','findMissingResultSfids','Attempted\x20to\x20create\x20job\x20','stream','batchPollingTimeout','SF_REFRESH_TOKEN','sfApiVersion','application/json','accessToken','\x20seconds.\x20Current\x20bulk\x20data\x20load\x20job\x20info\x20=>','apiVersion','deleteJob','concat','Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:','527107tTHKay','/jobs/ingest','18GZPDUO','options.operation','jobId','successfulResults','/services/data/v','length','SF_INSTANCE_URL','4bbFdJr','!!!\x20The\x20maximum\x20bulk\x20data\x20load\x20timeout\x20has\x20been\x20reached\x20(Timeout=','uploadResData\x20=>\x20','objArr','createJob\x20body\x20=>\x20','One\x20or\x20more\x20of\x20SF_LOGIN_URL,\x20SF_INSTANCE_URL,\x20SF_CLIENT_ID,\x20or\x20SF_REFRESH_TOKEN\x20config\x20vars\x20are\x20not\x20set.\x20Cannot\x20proceed\x20to\x20initialize\x20Bulk2Job\x20class.','75196tJZWZy','forEach','unprocessedrecords','delete','filter','/jobs/ingest/','runFullBulkJobFlow','splice','142070HDWqZR','unprocessedRecords','upload\x20response','status','Error\x20aborting\x20bulk\x20data\x20load\x20job:','options.object','map','object','\x20original\x20records.','getSFAxiosInstance','../../utils/required-param','Error\x20waiting\x20for\x20bulk\x20data\x20load\x20job\x20to\x20complete:\x20',',\x20jobInfo\x20=>\x20','warn','Bulk\x20job\x20was\x20missing\x20records\x20from\x20its\x20results!\x20','63CvNFyl','--\x20FORCE\x20REMOVING\x205\x20entries\x20from\x20bulk\x20successfulResults.\x20--','Error\x20getting\x20results\x20for\x20bulk\x20data\x20load\x20job\x20resultType:\x20','toFixed','text/csv','./https-wrapper.js','Error\x20retrieving\x20bulk\x20data\x20load\x20job\x20info:','error','end','./sf-axios-wrapper','Bad\x20Request','Error\x20retrieving\x20one\x20or\x20more\x20result\x20types\x20for\x20bulk\x20data\x20load\x20job:','1828vjMCfs','Initial\x20attempt\x20to\x20create\x20a\x20bulk\x20job\x20with\x20operation\x20hardDelete\x20has\x20failed\x20and\x20has\x20been\x20defaulted\x20to\x20standard\x20delete.\x20This\x20likely\x20means\x20the\x20Hard\x20Delete\x20administrative\x20permission\x20is\x20not\x20enabled\x20for\x20the\x20PC\x20SF\x20user.','createJob','36KTjLyY','timeoutHandle','operation','Error\x20closing\x20bulk\x20data\x20load\x20job\x20after\x20upload:\x20','abortJob','UploadComplete'];a25_0x3abd=function(){return _0x3e6043;};return a25_0x3abd();}if(!loginUrl||!instanceUrl||!clientId||!refreshToken){console[a25_0x216274(0xfa)](a25_0x216274(0xe4));return;}const sfAxiosWrapper=new SFAxiosWrapper(loginUrl,instanceUrl,clientId,refreshToken),sfAxios=sfAxiosWrapper[a25_0x216274(0xf6)]();class Bulk2Job{constructor(_0x33a64b){const _0x5f55b6=a25_0x216274;this[_0x5f55b6(0xf4)]=_0x33a64b['object']||requiredParam(_0x5f55b6(0xf2)),this[_0x5f55b6(0x8c)]=_0x33a64b['operation']||requiredParam(_0x5f55b6(0xd9)),this[_0x5f55b6(0x9e)]=_0x33a64b[_0x5f55b6(0x9e)]||_0x33a64b[_0x5f55b6(0x8c)]==_0x5f55b6(0x9d)?'id':null,this['apiVersion']=settings[_0x5f55b6(0xce)],this['pollingMs']=settings['batchPollingInterval']||0xfa0,this[_0x5f55b6(0xc2)]=settings[_0x5f55b6(0xcc)]||0x3e8*0x3c*0xa*0xa+0xea60,this['jobId']=null,this[_0x5f55b6(0x93)]=![],this[_0x5f55b6(0x8b)]=null;}async[a25_0x216274(0x89)](_0x5400db=0x1){const _0x5d337a=a25_0x216274;if(this[_0x5d337a(0xda)]){console[_0x5d337a(0xfa)](_0x5d337a(0xca)+this[_0x5d337a(0xda)]+'\x20twice,\x20will\x20not\x20create\x20again.');return;}const _0x506b55={'object':this[_0x5d337a(0xf4)],'operation':this[_0x5d337a(0x8c)]};this[_0x5d337a(0x9e)]&&(_0x506b55[_0x5d337a(0x9e)]=this[_0x5d337a(0x9e)]);console[_0x5d337a(0xb3)](_0x5d337a(0xe3)+JSON[_0x5d337a(0xb2)](_0x506b55));try{const _0x3cf34c=await sfAxios['post'](_0x5d337a(0xdc)+this[_0x5d337a(0xd2)]+_0x5d337a(0xd7),_0x506b55,{});this[_0x5d337a(0xda)]=_0x3cf34c[_0x5d337a(0xb1)]['id'],console[_0x5d337a(0xb3)]('Job\x20created\x20with\x20id:\x20'+this[_0x5d337a(0xda)]);}catch(_0x2ded44){if(_0x5400db===0x1&&_0x2ded44[_0x5d337a(0x9c)]&&_0x2ded44[_0x5d337a(0x9c)][_0x5d337a(0xf0)]==0x190&&_0x2ded44[_0x5d337a(0x9c)]['statusText']==_0x5d337a(0x106)&&this[_0x5d337a(0x8c)]===_0x5d337a(0xb8))return console[_0x5d337a(0xfa)](_0x5d337a(0x88)),this[_0x5d337a(0x8c)]=_0x5d337a(0xe8),this[_0x5d337a(0x93)]=!![],await this[_0x5d337a(0x89)](_0x5400db+0x1);else{_0x5400db>0x1&&console[_0x5d337a(0xfa)]('createJob\x20failed\x20on\x20a\x20retry,\x20this\x20should\x20not\x20happen!');throw _0x2ded44;}}}async['getJobInfo'](_0x525edf=this[a25_0x216274(0xda)]){const _0x3b99d1=a25_0x216274;try{const _0x20893d=await sfAxios[_0x3b99d1(0x94)](_0x3b99d1(0xdc)+this[_0x3b99d1(0xd2)]+_0x3b99d1(0xea)+_0x525edf,{});return _0x20893d[_0x3b99d1(0xb1)];}catch(_0x14d1da){return console[_0x3b99d1(0x103)](_0x3b99d1(0x102),_0x14d1da),null;}}async[a25_0x216274(0xaf)](_0x179040){const _0x5d4679=a25_0x216274;try{const _0x4e2576=objectToSfCsvStream(_0x179040),_0x92c5bb=await uploadData(instanceUrl,this[_0x5d4679(0xda)],sfAxiosWrapper[_0x5d4679(0xd0)],_0x4e2576);return console[_0x5d4679(0xb3)](_0x5d4679(0xef),_0x92c5bb),_0x92c5bb;}catch(_0x45dc3a){console[_0x5d4679(0x103)]('Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:',_0x45dc3a);throw new Error('Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:\x20'+_0x45dc3a);}}async[a25_0x216274(0xac)](_0x2e5c68){const _0x5b0013=a25_0x216274;try{const _0x1c2102=await objectToSfCsv(_0x2e5c68),_0x5c946a=_0x1c2102[_0x5b0013(0xbc)]('\x0a')[_0x5b0013(0xec)](0x0,0x5);console['log'](_0x5b0013(0xbd)+_0x5c946a[_0x5b0013(0xa8)]('\x0a'));try{const _0x65d17e=await sfAxios[_0x5b0013(0xaa)]('/services/data/v'+this[_0x5b0013(0xd2)]+_0x5b0013(0xea)+this[_0x5b0013(0xda)]+_0x5b0013(0xc8),_0x1c2102,{'headers':{'Content-Type':_0x5b0013(0x100)}});return _0x65d17e[_0x5b0013(0xb1)];}catch(_0x58d34c){return console['error'](_0x5b0013(0xd5),_0x58d34c),null;}}catch(_0x31e0d2){return console[_0x5b0013(0x103)]('Error\x20parsing\x20bulk\x20data\x20load\x20object\x20array\x20into\x20csv:',_0x31e0d2),null;}}async[a25_0x216274(0x8e)](_0x12034a=this[a25_0x216274(0xda)]){const _0x330660=a25_0x216274;return await this[_0x330660(0xc3)](_0x12034a,_0x330660(0xc7));}async[a25_0x216274(0xbe)](_0x41e97e=this['jobId']){const _0x39bb60=a25_0x216274;return await this['abortComplete'](_0x41e97e,_0x39bb60(0x8f));}async['abortComplete'](_0x29d59e=this['jobId'],_0x422eb9){const _0x210448=a25_0x216274,_0x183cbc={'state':_0x422eb9};try{const _0x55eea2=await sfAxios[_0x210448(0xa5)](_0x210448(0xdc)+this[_0x210448(0xd2)]+'/jobs/ingest/'+_0x29d59e,_0x183cbc,{'headers':{'Accept':_0x210448(0xcf)}});return _0x55eea2['data'];}catch(_0x449c37){return console['error'](_0x210448(0xf1),_0x449c37),null;}}async[a25_0x216274(0xd3)](_0x4de680=this[a25_0x216274(0xda)]){const _0x995d18=a25_0x216274;try{await sfAxios[_0x995d18(0xe8)](_0x995d18(0xdc)+this[_0x995d18(0xd2)]+_0x995d18(0xea)+_0x4de680,{});}catch(_0x56a154){return console['error'](_0x995d18(0xb7),_0x56a154),null;}}async[a25_0x216274(0x95)](_0x239b1a=this[a25_0x216274(0xda)]){const _0x56e5ee=a25_0x216274;return await this['getResults'](_0x239b1a,_0x56e5ee(0xdb));}async[a25_0x216274(0xb9)](_0x5da249=this[a25_0x216274(0xda)]){const _0x5bd971=a25_0x216274;return await this[_0x5bd971(0xb6)](_0x5da249,_0x5bd971(0xb5));}async['getUnprocessedRecords'](_0x4a8c2a=this[a25_0x216274(0xda)]){const _0x2e8b4a=a25_0x216274;return await this[_0x2e8b4a(0xb6)](_0x4a8c2a,_0x2e8b4a(0xe7));}async[a25_0x216274(0xb6)](_0x3c873f=this[a25_0x216274(0xda)],_0x324f49){const _0x4a92d2=a25_0x216274;try{const _0x1271ef=await sfAxios['get'](_0x4a92d2(0xdc)+this[_0x4a92d2(0xd2)]+_0x4a92d2(0xea)+_0x3c873f+'/'+_0x324f49+'/',{'responseType':_0x4a92d2(0xcb)});return new Promise((_0x38c2b6,_0xe4dff2)=>{const _0x3ffb85=_0x4a92d2,_0x2b53df=_0x1271ef[_0x3ffb85(0xb1)],_0x6836c1=[];_0x2b53df['on']('data',_0x97d058=>{const _0x1dfd20=_0x3ffb85;_0x6836c1[_0x1dfd20(0xb4)](_0x97d058);}),_0x2b53df['on'](_0x3ffb85(0x104),async()=>{const _0x5bfd39=_0x3ffb85,_0x1d56c4=Buffer[_0x5bfd39(0xd4)](_0x6836c1)['toString']('utf-8'),_0x58abf0=await sfCsvToObject(_0x1d56c4);console['log'](_0x58abf0[_0x5bfd39(0xdd)]),console['log']('object\x20array',_0x58abf0),_0x38c2b6(_0x58abf0);});});}catch(_0x2e03bd){return console[_0x4a92d2(0x103)](_0x4a92d2(0xfe)+_0x324f49+':',_0x2e03bd),null;}}async[a25_0x216274(0xc6)](_0x33ba7e=this['jobId']){const _0x22f2b7=a25_0x216274,_0x1aeb33=this[_0x22f2b7(0x95)](_0x33ba7e),_0x2ea41a=this[_0x22f2b7(0xb9)](_0x33ba7e),_0x1f7025=this['getUnprocessedRecords'](_0x33ba7e);try{const [_0x52fbad,_0x25c202,_0x268575]=await Promise['all']([_0x1aeb33,_0x2ea41a,_0x1f7025]);return{'successfulResults':_0x52fbad,'failedResults':_0x25c202,'unprocessedRecords':_0x268575};}catch(_0x585f9e){return console[_0x22f2b7(0xb3)](_0x22f2b7(0x107),_0x585f9e),null;}}[a25_0x216274(0xc9)](_0x13a4eb,_0xea6c81){const _0x4329e0=a25_0x216274,_0xec0a34=[..._0xea6c81[_0x4329e0(0xdb)][_0x4329e0(0xf3)](_0x27d4e4=>_0x27d4e4[_0x4329e0(0x96)]?_0x27d4e4[_0x4329e0(0x96)]:_0x27d4e4['id'])[_0x4329e0(0xe9)](Boolean),..._0xea6c81['successfulResults'][_0x4329e0(0xf3)](_0x984ea9=>_0x984ea9['id']&&_0x984ea9['id']!==_0x984ea9[_0x4329e0(0x96)]?_0x984ea9['id']:null)[_0x4329e0(0xe9)](Boolean),..._0xea6c81[_0x4329e0(0xb5)]['map'](_0x2753a8=>_0x2753a8['sf__Id']?_0x2753a8['sf__Id']:_0x2753a8['id'])[_0x4329e0(0xe9)](Boolean),..._0xea6c81[_0x4329e0(0xee)][_0x4329e0(0xf3)](_0x293cfe=>_0x293cfe['id'])[_0x4329e0(0xe9)](Boolean)],_0x42de36=_0xea6c81[_0x4329e0(0xdb)]['length']+_0xea6c81[_0x4329e0(0xb5)][_0x4329e0(0xdd)]+_0xea6c81[_0x4329e0(0xee)][_0x4329e0(0xdd)],_0x17d98c=[];return console[_0x4329e0(0xb3)]('Total\x20Res\x20counts\x20'+_0x42de36),_0x13a4eb[_0x4329e0(0xe6)](_0x1ea7aa=>{const _0x4a686d=_0x4329e0,_0x33aecc=_0x1ea7aa['id'];if(!_0x33aecc){console[_0x4a686d(0x103)](_0x4a686d(0xc0));return;}!_0xec0a34[_0x4a686d(0xad)](_0x33aecc)&&_0x17d98c['push'](_0x33aecc);}),_0x17d98c[_0x4329e0(0xdd)]&&console[_0x4329e0(0x103)](_0x4329e0(0xfb)+_0x17d98c['length']+'\x20out\x20of\x20'+_0x13a4eb[_0x4329e0(0xdd)]+_0x4329e0(0xf5)),_0x17d98c;}async[a25_0x216274(0xeb)](_0x2d07e5=requiredParam(a25_0x216274(0xe2))){let _0x2cf2bd=_0x2d07e5?_0x2d07e5['length']:0x0,_0xcf3802,_0x246a11,_0x3d42ab=[];return new Promise(async(_0x4a2eb0,_0xb56c46)=>{const _0x5a6ce4=a25_0x29a5,_0x1ee569=new Date();try{console[_0x5a6ce4(0xb3)]('===\x20Creating\x20new\x20job...'),await this[_0x5a6ce4(0x89)]();try{console[_0x5a6ce4(0xb3)](_0x5a6ce4(0x91));const _0x5282c4=await this['uploadJobdataStream'](_0x2d07e5);console[_0x5a6ce4(0xb3)](_0x5a6ce4(0xe1),_0x5282c4);let _0x4f2fee=![];this[_0x5a6ce4(0x8b)]=setTimeout(async()=>{const _0x2c6c62=_0x5a6ce4;_0x4f2fee=!![],_0xcf3802=await this[_0x2c6c62(0x92)](),console['error'](_0x2c6c62(0xe0)+this[_0x2c6c62(0xc2)]/0x3e8+'\x20sec).\x20Aborting\x20job\x20after\x20'+((new Date()['getTime']()-_0x1ee569['getTime']())/0x3e8)[_0x2c6c62(0xff)](0x1)+_0x2c6c62(0xd1),_0xcf3802);const _0x4196d2=await this[_0x2c6c62(0x8e)]();await sleep(0x7d0),_0xcf3802=await this[_0x2c6c62(0x92)](),_0x246a11=await this[_0x2c6c62(0xc6)](),_0x3d42ab=this[_0x2c6c62(0xc9)](_0x2d07e5,_0x246a11),_0x4a2eb0({'jobInfo':_0xcf3802,'results':_0x246a11,'coercedToStandardDelete':this[_0x2c6c62(0x93)],'initialCount':_0x2cf2bd,'missingFromResultSfids':_0x3d42ab,'timedOut':!![],'startTs':_0x1ee569,'endTs':new Date()});},this[_0x5a6ce4(0xc2)]);try{console[_0x5a6ce4(0xb3)](_0x5a6ce4(0x9b));const _0x5cdb95=await this[_0x5a6ce4(0xbe)]();console[_0x5a6ce4(0xb3)]('closeData\x20=>\x20',_0x5cdb95);try{_0xcf3802=_0x5cdb95;if(_0xcf3802['state']==_0x5a6ce4(0x90)){await sleep(this[_0x5a6ce4(0xa2)]*0x2),_0xcf3802=await this[_0x5a6ce4(0x92)]();if(_0xcf3802[_0x5a6ce4(0xbf)]=='Open')throw new Error(_0x5a6ce4(0xc5));}while(_0xcf3802['state']==_0x5a6ce4(0x8f)||_0xcf3802[_0x5a6ce4(0xbf)]==_0x5a6ce4(0xc1)){if(_0x4f2fee)return;await sleep(this[_0x5a6ce4(0xa2)]),_0xcf3802=await this[_0x5a6ce4(0x92)]();}clearTimeout(this[_0x5a6ce4(0x8b)]);if(_0x4f2fee)return;_0x246a11=await this[_0x5a6ce4(0xc6)]();process[_0x5a6ce4(0xae)][_0x5a6ce4(0x9f)]&&Math['floor'](Math[_0x5a6ce4(0x97)]()*0x2)==0x0&&(console[_0x5a6ce4(0xfa)](_0x5a6ce4(0xfd)),_0x246a11['successfulResults']['splice'](0x0,0x5));const _0x52bd09=new Date(),_0x1187d5=((_0x52bd09[_0x5a6ce4(0xc4)]()-_0x1ee569[_0x5a6ce4(0xc4)]())/0x3e8)[_0x5a6ce4(0xff)](0x1);console['log']('Bulk\x20data\x20load\x20job\x20completed\x20after\x20'+_0x1187d5+_0x5a6ce4(0xb0)+this[_0x5a6ce4(0xf4)]+_0x5a6ce4(0xa3)+_0xcf3802[_0x5a6ce4(0xbf)]+_0x5a6ce4(0xf9),_0xcf3802),_0x3d42ab=this['findMissingResultSfids'](_0x2d07e5,_0x246a11),_0x4a2eb0({'jobInfo':_0xcf3802,'results':_0x246a11,'coercedToStandardDelete':this['coercedToStandardDelete'],'initialCount':_0x2cf2bd,'missingFromResultSfids':_0x3d42ab,'startTs':_0x1ee569,'endTs':new Date()});}catch(_0x2745a6){_0xb56c46(_0x2745a6),console[_0x5a6ce4(0x103)](_0x5a6ce4(0xf8),_0x2745a6[_0x5a6ce4(0xa7)]);}}catch(_0x3489ae){_0xb56c46(_0x3489ae),console[_0x5a6ce4(0x103)](_0x5a6ce4(0x8d),_0x3489ae['message']);}}catch(_0xecbcdf){_0xb56c46(_0xecbcdf),console['error'](_0x5a6ce4(0xa0),_0xecbcdf[_0x5a6ce4(0xa7)]);}}catch(_0x2b1344){_0xb56c46(_0x2b1344),console[_0x5a6ce4(0x103)](_0x5a6ce4(0xab),_0x2b1344[_0x5a6ce4(0xa7)]);}_0x4a2eb0({'jobInfo':_0xcf3802,'results':_0x246a11,'coercedToStandardDelete':this['coercedToStandardDelete'],'initialCount':_0x2cf2bd,'missingFromResultSfids':_0x3d42ab,'startTs':_0x1ee569,'endTs':new Date()});});}}exports=module[a25_0x216274(0xa1)]=Bulk2Job;
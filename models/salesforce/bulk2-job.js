function a25_0x1cb9(_0x25ba16,_0x241b55){const _0xdac1b7=a25_0xdac1();return a25_0x1cb9=function(_0x1cb919,_0x17e4a2){_0x1cb919=_0x1cb919-0x19b;let _0x3ca470=_0xdac1b7[_0x1cb919];return _0x3ca470;},a25_0x1cb9(_0x25ba16,_0x241b55);}const a25_0x98c5cb=a25_0x1cb9;(function(_0x242468,_0x41af4a){const _0x3ef07b=a25_0x1cb9,_0x2634c0=_0x242468();while(!![]){try{const _0x434eef=parseInt(_0x3ef07b(0x203))/0x1*(-parseInt(_0x3ef07b(0x210))/0x2)+-parseInt(_0x3ef07b(0x1cd))/0x3+parseInt(_0x3ef07b(0x1a3))/0x4*(-parseInt(_0x3ef07b(0x1d9))/0x5)+-parseInt(_0x3ef07b(0x211))/0x6+parseInt(_0x3ef07b(0x1bc))/0x7+parseInt(_0x3ef07b(0x19d))/0x8*(parseInt(_0x3ef07b(0x19b))/0x9)+parseInt(_0x3ef07b(0x19c))/0xa;if(_0x434eef===_0x41af4a)break;else _0x2634c0['push'](_0x2634c0['shift']());}catch(_0xb6635d){_0x2634c0['push'](_0x2634c0['shift']());}}}(a25_0xdac1,0x5014e));const requiredParam=require(a25_0x98c5cb(0x1e1)),SFAxiosWrapper=require('./sf-axios-wrapper'),settings=require(a25_0x98c5cb(0x1e6)),{objectToSfCsv,sfCsvToObject,objectToSfCsvStream}=require(a25_0x98c5cb(0x1d4)),{uploadData}=require(a25_0x98c5cb(0x1ec)),sleep=require(a25_0x98c5cb(0x1ca)),loginUrl=process['env']['SF_LOGIN_URL'],instanceUrl=process[a25_0x98c5cb(0x1a6)]['SF_INSTANCE_URL'],clientId=process['env'][a25_0x98c5cb(0x1c1)],refreshToken=process['env']['SF_REFRESH_TOKEN'];function a25_0xdac1(){const _0x110dc7=['error','jobId','Total\x20Res\x20counts\x20','Error\x20deleting\x20bulk\x20data\x20load\x20job:','213029SPoGwa','accessToken','random','forEach','concat','post','uploadResData\x20=>\x20','\x20seconds.\x20Current\x20bulk\x20data\x20load\x20job\x20info\x20=>','sf__Id','\x20out\x20of\x20','get','/jobs/ingest','createJob\x20body\x20=>\x20','2NmXoMc','2300940rzXkxF','pollingMs','object\x20array','1878273aOBOAD','10629000ijxkmt','8cOfFxi','Attempted\x20to\x20create\x20job\x20','uploadJobData','length','options.operation','Job\x20created\x20with\x20id:\x20','119812LPCEle','Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:','sfApiVersion','env','delete','utf-8','getUnprocessedRecords','getJobInfo','application/json','\x20seconds\x20on\x20OBJECT:\x20','end','===\x20Uploading\x20job\x20csv...','includes','apiVersion','getFailedResults','Aborted','\x20twice,\x20will\x20not\x20create\x20again.','/batches','put','\x20sec).\x20Aborting\x20job\x20after\x20','Error\x20parsing\x20bulk\x20data\x20load\x20object\x20array\x20into\x20csv:','===\x20Closing\x20job...','findMissingResultSfids',',\x20jobInfo\x20=>\x20','filter','2019283cEifqB','createJob','stringify','!!!\x20The\x20maximum\x20bulk\x20data\x20load\x20timeout\x20has\x20been\x20reached\x20(Timeout=','/jobs/ingest/','SF_CLIENT_ID','externalIdFieldName','floor','message','all','InProgress','log','unprocessedrecords','state','../../utils/sleep','Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:\x20','runFullBulkJobFlow','468855fdOfvL','abortComplete','timeoutHandle','getSuccessfulResults',',\x20STATE:\x20','closeData\x20=>\x20','splice','./sf-csv-utils','Bulk\x20data\x20load\x20job\x20is\x20still\x20open\x20after\x20attempting\x20to\x20mark\x20it\x20upload\x20closed.\x20This\x20should\x20not\x20happen.','pollingTimeoutMs','getResults','Initial\x20attempt\x20to\x20create\x20a\x20bulk\x20job\x20with\x20operation\x20hardDelete\x20has\x20failed\x20and\x20has\x20been\x20defaulted\x20to\x20standard\x20delete.\x20This\x20likely\x20means\x20the\x20Hard\x20Delete\x20administrative\x20permission\x20is\x20not\x20enabled\x20for\x20the\x20PC\x20SF\x20user.','80dvHXvr','upload\x20response','UploadComplete','push','getSFAxiosInstance','map','failedResults','hardDelete','../../utils/required-param','response','object','coercedToStandardDelete','warn','../../settings','\x20original\x20records.','join','abortJob','operation','Error\x20aborting\x20bulk\x20data\x20load\x20job:','./https-wrapper.js','Bad\x20Request','closeJob','getAllResults','One\x20or\x20more\x20of\x20SF_LOGIN_URL,\x20SF_INSTANCE_URL,\x20SF_CLIENT_ID,\x20or\x20SF_REFRESH_TOKEN\x20config\x20vars\x20are\x20not\x20set.\x20Cannot\x20proceed\x20to\x20initialize\x20Bulk2Job\x20class.','unprocessedRecords','getTime','Row\x20was\x20missing\x20sfid\x20in\x20the\x20objArr.','upsert','===\x20Creating\x20new\x20job...','batchPollingInterval','batchPollingTimeout','Error\x20retrieving\x20one\x20or\x20more\x20result\x20types\x20for\x20bulk\x20data\x20load\x20job:','text/csv','/services/data/v','data','successfulResults','createJob\x20failed\x20on\x20a\x20retry,\x20this\x20should\x20not\x20happen!','exports'];a25_0xdac1=function(){return _0x110dc7;};return a25_0xdac1();}if(!loginUrl||!instanceUrl||!clientId||!refreshToken){console[a25_0x98c5cb(0x1e5)](a25_0x98c5cb(0x1f0));return;}const sfAxiosWrapper=new SFAxiosWrapper(loginUrl,instanceUrl,clientId,refreshToken),sfAxios=sfAxiosWrapper[a25_0x98c5cb(0x1dd)]();class Bulk2Job{constructor(_0x2c4ebb){const _0x173058=a25_0x98c5cb;this[_0x173058(0x1e3)]=_0x2c4ebb[_0x173058(0x1e3)]||requiredParam('options.object'),this[_0x173058(0x1ea)]=_0x2c4ebb[_0x173058(0x1ea)]||requiredParam(_0x173058(0x1a1)),this[_0x173058(0x1c2)]=_0x2c4ebb[_0x173058(0x1c2)]||_0x2c4ebb['operation']==_0x173058(0x1f4)?'id':null,this[_0x173058(0x1b0)]=settings[_0x173058(0x1a5)],this[_0x173058(0x212)]=settings[_0x173058(0x1f6)]||0xfa0,this[_0x173058(0x1d6)]=settings[_0x173058(0x1f7)]||0x3e8*0x3c*0xa*0xa+0xea60,this[_0x173058(0x200)]=null,this[_0x173058(0x1e4)]=![],this[_0x173058(0x1cf)]=null;}async[a25_0x98c5cb(0x1bd)](_0x92e7a9=0x1){const _0x452830=a25_0x98c5cb;if(this[_0x452830(0x200)]){console[_0x452830(0x1e5)](_0x452830(0x19e)+this[_0x452830(0x200)]+_0x452830(0x1b3));return;}const _0xd63b83={'object':this[_0x452830(0x1e3)],'operation':this[_0x452830(0x1ea)]};this[_0x452830(0x1c2)]&&(_0xd63b83[_0x452830(0x1c2)]=this[_0x452830(0x1c2)]);console[_0x452830(0x1c7)](_0x452830(0x20f)+JSON[_0x452830(0x1be)](_0xd63b83));try{const _0x5ccf77=await sfAxios[_0x452830(0x208)]('/services/data/v'+this[_0x452830(0x1b0)]+_0x452830(0x20e),_0xd63b83,{});this[_0x452830(0x200)]=_0x5ccf77['data']['id'],console['log'](_0x452830(0x1a2)+this[_0x452830(0x200)]);}catch(_0x57d53c){if(_0x92e7a9===0x1&&_0x57d53c[_0x452830(0x1e2)]&&_0x57d53c[_0x452830(0x1e2)]['status']==0x190&&_0x57d53c[_0x452830(0x1e2)]['statusText']==_0x452830(0x1ed)&&this[_0x452830(0x1ea)]===_0x452830(0x1e0))return console[_0x452830(0x1e5)](_0x452830(0x1d8)),this['operation']=_0x452830(0x1a7),this[_0x452830(0x1e4)]=!![],await this[_0x452830(0x1bd)](_0x92e7a9+0x1);else{_0x92e7a9>0x1&&console[_0x452830(0x1e5)](_0x452830(0x1fd));throw _0x57d53c;}}}async[a25_0x98c5cb(0x1aa)](_0x51bb27=this[a25_0x98c5cb(0x200)]){const _0x5f46b1=a25_0x98c5cb;try{const _0x294727=await sfAxios['get']('/services/data/v'+this[_0x5f46b1(0x1b0)]+_0x5f46b1(0x1c0)+_0x51bb27,{});return _0x294727['data'];}catch(_0x562e86){return console[_0x5f46b1(0x1ff)]('Error\x20retrieving\x20bulk\x20data\x20load\x20job\x20info:',_0x562e86),null;}}async['uploadJobdataStream'](_0x2f717e){const _0x19164f=a25_0x98c5cb;try{const _0x10b63c=objectToSfCsvStream(_0x2f717e),_0x4928fd=await uploadData(instanceUrl,this[_0x19164f(0x200)],sfAxiosWrapper[_0x19164f(0x204)],_0x10b63c);return console[_0x19164f(0x1c7)](_0x19164f(0x1da),_0x4928fd),_0x4928fd;}catch(_0x29e226){console[_0x19164f(0x1ff)](_0x19164f(0x1a4),_0x29e226);throw new Error(_0x19164f(0x1cb)+_0x29e226);}}async[a25_0x98c5cb(0x19f)](_0x2f6f62){const _0x5de47c=a25_0x98c5cb;try{const _0x4e3cf5=await objectToSfCsv(_0x2f6f62),_0x576802=_0x4e3cf5['split']('\x0a')[_0x5de47c(0x1d3)](0x0,0x5);console[_0x5de47c(0x1c7)]('First\x205\x20lines\x20of\x20csv\x20data\x20(incl\x20header):\x0a'+_0x576802[_0x5de47c(0x1e8)]('\x0a'));try{const _0x87d6aa=await sfAxios[_0x5de47c(0x1b5)](_0x5de47c(0x1fa)+this[_0x5de47c(0x1b0)]+_0x5de47c(0x1c0)+this[_0x5de47c(0x200)]+_0x5de47c(0x1b4),_0x4e3cf5,{'headers':{'Content-Type':_0x5de47c(0x1f9)}});return _0x87d6aa['data'];}catch(_0x5e2731){return console[_0x5de47c(0x1ff)](_0x5de47c(0x1a4),_0x5e2731),null;}}catch(_0x2e9728){return console[_0x5de47c(0x1ff)](_0x5de47c(0x1b7),_0x2e9728),null;}}async['abortJob'](_0x44e79c=this[a25_0x98c5cb(0x200)]){const _0x5b0a38=a25_0x98c5cb;return await this[_0x5b0a38(0x1ce)](_0x44e79c,_0x5b0a38(0x1b2));}async[a25_0x98c5cb(0x1ee)](_0x2badba=this['jobId']){const _0x185156=a25_0x98c5cb;return await this['abortComplete'](_0x2badba,_0x185156(0x1db));}async['abortComplete'](_0x4899a9=this[a25_0x98c5cb(0x200)],_0x20c2f0){const _0x9a4610=a25_0x98c5cb,_0x2f33f1={'state':_0x20c2f0};try{const _0x2d1be7=await sfAxios['patch'](_0x9a4610(0x1fa)+this[_0x9a4610(0x1b0)]+_0x9a4610(0x1c0)+_0x4899a9,_0x2f33f1,{'headers':{'Accept':_0x9a4610(0x1ab)}});return _0x2d1be7['data'];}catch(_0x4a68dc){return console['error'](_0x9a4610(0x1eb),_0x4a68dc),null;}}async['deleteJob'](_0x2c9da6=this[a25_0x98c5cb(0x200)]){const _0x2922c9=a25_0x98c5cb;try{await sfAxios[_0x2922c9(0x1a7)](_0x2922c9(0x1fa)+this[_0x2922c9(0x1b0)]+_0x2922c9(0x1c0)+_0x2c9da6,{});}catch(_0x12e8e3){return console['error'](_0x2922c9(0x202),_0x12e8e3),null;}}async[a25_0x98c5cb(0x1d0)](_0x483f5b=this[a25_0x98c5cb(0x200)]){const _0x203f8c=a25_0x98c5cb;return await this[_0x203f8c(0x1d7)](_0x483f5b,_0x203f8c(0x1fc));}async['getFailedResults'](_0x53b616=this[a25_0x98c5cb(0x200)]){const _0x80a01a=a25_0x98c5cb;return await this[_0x80a01a(0x1d7)](_0x53b616,_0x80a01a(0x1df));}async[a25_0x98c5cb(0x1a9)](_0x46087e=this[a25_0x98c5cb(0x200)]){const _0x1ea1e7=a25_0x98c5cb;return await this[_0x1ea1e7(0x1d7)](_0x46087e,_0x1ea1e7(0x1c8));}async['getResults'](_0x21fe90=this[a25_0x98c5cb(0x200)],_0x1be0bf){const _0xa44f50=a25_0x98c5cb;try{const _0x311a32=await sfAxios[_0xa44f50(0x20d)](_0xa44f50(0x1fa)+this[_0xa44f50(0x1b0)]+_0xa44f50(0x1c0)+_0x21fe90+'/'+_0x1be0bf+'/',{'responseType':'stream'});return new Promise((_0x47b65c,_0x23ca22)=>{const _0x4a207c=_0xa44f50,_0x29d928=_0x311a32['data'],_0x929c2e=[];_0x29d928['on'](_0x4a207c(0x1fb),_0x404fac=>{const _0x56559a=_0x4a207c;_0x929c2e[_0x56559a(0x1dc)](_0x404fac);}),_0x29d928['on'](_0x4a207c(0x1ad),async()=>{const _0x10f084=_0x4a207c,_0x1cebde=Buffer[_0x10f084(0x207)](_0x929c2e)['toString'](_0x10f084(0x1a8)),_0x4109ec=await sfCsvToObject(_0x1cebde);console[_0x10f084(0x1c7)](_0x4109ec[_0x10f084(0x1a0)]),console[_0x10f084(0x1c7)](_0x10f084(0x213),_0x4109ec),_0x47b65c(_0x4109ec);});});}catch(_0x3c5fee){return console['error']('Error\x20getting\x20results\x20for\x20bulk\x20data\x20load\x20job\x20resultType:\x20'+_0x1be0bf+':',_0x3c5fee),null;}}async[a25_0x98c5cb(0x1ef)](_0x237b20=this[a25_0x98c5cb(0x200)]){const _0x928da1=a25_0x98c5cb,_0x4e0fe7=this[_0x928da1(0x1d0)](_0x237b20),_0x26a9be=this[_0x928da1(0x1b1)](_0x237b20),_0x101a95=this['getUnprocessedRecords'](_0x237b20);try{const [_0x25de19,_0x4e7e0b,_0x8b34b7]=await Promise[_0x928da1(0x1c5)]([_0x4e0fe7,_0x26a9be,_0x101a95]);return{'successfulResults':_0x25de19,'failedResults':_0x4e7e0b,'unprocessedRecords':_0x8b34b7};}catch(_0x5086c1){return console[_0x928da1(0x1c7)](_0x928da1(0x1f8),_0x5086c1),null;}}[a25_0x98c5cb(0x1b9)](_0x284b20,_0x1be4aa){const _0x593552=a25_0x98c5cb,_0x572f6a=[..._0x1be4aa[_0x593552(0x1fc)]['map'](_0x3bdbc1=>_0x3bdbc1[_0x593552(0x20b)]?_0x3bdbc1['sf__Id']:_0x3bdbc1['id'])[_0x593552(0x1bb)](Boolean),..._0x1be4aa[_0x593552(0x1fc)][_0x593552(0x1de)](_0x58c34f=>_0x58c34f['id']&&_0x58c34f['id']!==_0x58c34f['sf__Id']?_0x58c34f['id']:null)[_0x593552(0x1bb)](Boolean),..._0x1be4aa['failedResults']['map'](_0xfb5066=>_0xfb5066[_0x593552(0x20b)]?_0xfb5066[_0x593552(0x20b)]:_0xfb5066['id'])[_0x593552(0x1bb)](Boolean),..._0x1be4aa[_0x593552(0x1f1)][_0x593552(0x1de)](_0x267d26=>_0x267d26['id'])[_0x593552(0x1bb)](Boolean)],_0x104ed1=_0x1be4aa[_0x593552(0x1fc)]['length']+_0x1be4aa[_0x593552(0x1df)][_0x593552(0x1a0)]+_0x1be4aa[_0x593552(0x1f1)][_0x593552(0x1a0)],_0x220b7f=[];return console[_0x593552(0x1c7)](_0x593552(0x201)+_0x104ed1),_0x284b20[_0x593552(0x206)](_0x5e16c7=>{const _0x5280ed=_0x593552,_0x3782f3=_0x5e16c7['id'];if(!_0x3782f3){console['error'](_0x5280ed(0x1f3));return;}!_0x572f6a[_0x5280ed(0x1af)](_0x3782f3)&&_0x220b7f[_0x5280ed(0x1dc)](_0x3782f3);}),_0x220b7f[_0x593552(0x1a0)]&&console['error']('Bulk\x20job\x20was\x20missing\x20records\x20from\x20its\x20results!\x20'+_0x220b7f['length']+_0x593552(0x20c)+_0x284b20['length']+_0x593552(0x1e7)),_0x220b7f;}async[a25_0x98c5cb(0x1cc)](_0x56ff6e=requiredParam('objArr')){const _0x1b93f1=a25_0x98c5cb;let _0xf5bb56=_0x56ff6e?_0x56ff6e[_0x1b93f1(0x1a0)]:0x0,_0x473ba4,_0x5983d9,_0x3560ee=[];return new Promise(async(_0x2b464e,_0x163984)=>{const _0x1e5829=_0x1b93f1,_0x2b3a62=new Date();try{console['log'](_0x1e5829(0x1f5)),await this['createJob']();try{console[_0x1e5829(0x1c7)](_0x1e5829(0x1ae));const _0x4d95c8=await this['uploadJobdataStream'](_0x56ff6e);console[_0x1e5829(0x1c7)](_0x1e5829(0x209),_0x4d95c8);let _0x4ce0dc=![];this[_0x1e5829(0x1cf)]=setTimeout(async()=>{const _0x4847d9=_0x1e5829;_0x4ce0dc=!![],_0x473ba4=await this[_0x4847d9(0x1aa)](),console[_0x4847d9(0x1ff)](_0x4847d9(0x1bf)+this['pollingTimeoutMs']/0x3e8+_0x4847d9(0x1b6)+((new Date()[_0x4847d9(0x1f2)]()-_0x2b3a62[_0x4847d9(0x1f2)]())/0x3e8)['toFixed'](0x1)+_0x4847d9(0x20a),_0x473ba4);const _0x78a2ce=await this[_0x4847d9(0x1e9)]();await sleep(0x7d0),_0x473ba4=await this[_0x4847d9(0x1aa)](),_0x5983d9=await this[_0x4847d9(0x1ef)](),_0x3560ee=this['findMissingResultSfids'](_0x56ff6e,_0x5983d9),_0x2b464e({'jobInfo':_0x473ba4,'results':_0x5983d9,'coercedToStandardDelete':this[_0x4847d9(0x1e4)],'initialCount':_0xf5bb56,'missingFromResultSfids':_0x3560ee,'timedOut':!![],'startTs':_0x2b3a62,'endTs':new Date()});},this[_0x1e5829(0x1d6)]);try{console[_0x1e5829(0x1c7)](_0x1e5829(0x1b8));const _0x59ba6f=await this['closeJob']();console[_0x1e5829(0x1c7)](_0x1e5829(0x1d2),_0x59ba6f);try{_0x473ba4=_0x59ba6f;if(_0x473ba4[_0x1e5829(0x1c9)]=='Open'){await sleep(this[_0x1e5829(0x212)]*0x2),_0x473ba4=await this[_0x1e5829(0x1aa)]();if(_0x473ba4['state']=='Open')throw new Error(_0x1e5829(0x1d5));}while(_0x473ba4['state']=='UploadComplete'||_0x473ba4[_0x1e5829(0x1c9)]==_0x1e5829(0x1c6)){if(_0x4ce0dc)return;await sleep(this[_0x1e5829(0x212)]),_0x473ba4=await this[_0x1e5829(0x1aa)]();}clearTimeout(this[_0x1e5829(0x1cf)]);if(_0x4ce0dc)return;_0x5983d9=await this['getAllResults']();process[_0x1e5829(0x1a6)]['FORCE_BULK_RESULT_REMOVALS_TEST']&&Math[_0x1e5829(0x1c3)](Math[_0x1e5829(0x205)]()*0x2)==0x0&&(console[_0x1e5829(0x1e5)]('--\x20FORCE\x20REMOVING\x205\x20entries\x20from\x20bulk\x20successfulResults.\x20--'),_0x5983d9[_0x1e5829(0x1fc)][_0x1e5829(0x1d3)](0x0,0x5));const _0x43f50e=new Date(),_0x4c80d8=((_0x43f50e['getTime']()-_0x2b3a62[_0x1e5829(0x1f2)]())/0x3e8)['toFixed'](0x1);console[_0x1e5829(0x1c7)]('Bulk\x20data\x20load\x20job\x20completed\x20after\x20'+_0x4c80d8+_0x1e5829(0x1ac)+this[_0x1e5829(0x1e3)]+_0x1e5829(0x1d1)+_0x473ba4['state']+_0x1e5829(0x1ba),_0x473ba4),_0x3560ee=this[_0x1e5829(0x1b9)](_0x56ff6e,_0x5983d9),_0x2b464e({'jobInfo':_0x473ba4,'results':_0x5983d9,'coercedToStandardDelete':this[_0x1e5829(0x1e4)],'initialCount':_0xf5bb56,'missingFromResultSfids':_0x3560ee,'startTs':_0x2b3a62,'endTs':new Date()});}catch(_0x26b965){_0x163984(_0x26b965),console[_0x1e5829(0x1ff)]('Error\x20waiting\x20for\x20bulk\x20data\x20load\x20job\x20to\x20complete:\x20',_0x26b965[_0x1e5829(0x1c4)]);}}catch(_0x4e1c87){_0x163984(_0x4e1c87),console['error']('Error\x20closing\x20bulk\x20data\x20load\x20job\x20after\x20upload:\x20',_0x4e1c87[_0x1e5829(0x1c4)]);}}catch(_0x510686){_0x163984(_0x510686),console[_0x1e5829(0x1ff)](_0x1e5829(0x1cb),_0x510686[_0x1e5829(0x1c4)]);}}catch(_0x1e6b9f){_0x163984(_0x1e6b9f),console[_0x1e5829(0x1ff)]('Error\x20creating\x20bulk\x20data\x20load\x20job:\x20',_0x1e6b9f['message']);}_0x2b464e({'jobInfo':_0x473ba4,'results':_0x5983d9,'coercedToStandardDelete':this[_0x1e5829(0x1e4)],'initialCount':_0xf5bb56,'missingFromResultSfids':_0x3560ee,'startTs':_0x2b3a62,'endTs':new Date()});});}}exports=module[a25_0x98c5cb(0x1fe)]=Bulk2Job;
const a25_0x286b2e=a25_0x383f;(function(_0x24a7e0,_0x3f49be){const _0x37051b=a25_0x383f,_0x3901b8=_0x24a7e0();while(!![]){try{const _0xcc2f20=parseInt(_0x37051b(0x129))/0x1+parseInt(_0x37051b(0x116))/0x2*(parseInt(_0x37051b(0xd8))/0x3)+-parseInt(_0x37051b(0xdb))/0x4+parseInt(_0x37051b(0x132))/0x5*(parseInt(_0x37051b(0x127))/0x6)+-parseInt(_0x37051b(0x13c))/0x7+-parseInt(_0x37051b(0xe1))/0x8+parseInt(_0x37051b(0x113))/0x9;if(_0xcc2f20===_0x3f49be)break;else _0x3901b8['push'](_0x3901b8['shift']());}catch(_0x5e5b7d){_0x3901b8['push'](_0x3901b8['shift']());}}}(a25_0x2ac8,0x3454e));const requiredParam=require('../../utils/required-param'),SFAxiosWrapper=require(a25_0x286b2e(0x108)),settings=require(a25_0x286b2e(0x10f)),{objectToSfCsv,sfCsvToObject,objectToSfCsvStream}=require(a25_0x286b2e(0x148)),{uploadData}=require(a25_0x286b2e(0xdc)),sleep=require(a25_0x286b2e(0xec)),loginUrl=process[a25_0x286b2e(0x13f)][a25_0x286b2e(0x119)],instanceUrl=process[a25_0x286b2e(0x13f)][a25_0x286b2e(0xea)],clientId=process[a25_0x286b2e(0x13f)]['SF_CLIENT_ID'],refreshToken=process[a25_0x286b2e(0x13f)][a25_0x286b2e(0x10e)];if(!loginUrl||!instanceUrl||!clientId||!refreshToken){console[a25_0x286b2e(0xdf)]('One\x20or\x20more\x20of\x20SF_LOGIN_URL,\x20SF_INSTANCE_URL,\x20SF_CLIENT_ID,\x20or\x20SF_REFRESH_TOKEN\x20config\x20vars\x20are\x20not\x20set.\x20Cannot\x20proceed\x20to\x20initialize\x20Bulk2Job\x20class.');return;}function a25_0x383f(_0x7b3df1,_0x326859){const _0x2ac8c4=a25_0x2ac8();return a25_0x383f=function(_0x383fc1,_0x52dabd){_0x383fc1=_0x383fc1-0xcf;let _0x385d0f=_0x2ac8c4[_0x383fc1];return _0x385d0f;},a25_0x383f(_0x7b3df1,_0x326859);}const sfAxiosWrapper=new SFAxiosWrapper(loginUrl,instanceUrl,clientId,refreshToken),sfAxios=sfAxiosWrapper['getSFAxiosInstance']();class Bulk2Job{constructor(_0x631596){const _0x5b0afa=a25_0x286b2e;this[_0x5b0afa(0xf7)]=_0x631596[_0x5b0afa(0xf7)]||requiredParam(_0x5b0afa(0x10a)),this[_0x5b0afa(0x107)]=_0x631596[_0x5b0afa(0x107)]||requiredParam(_0x5b0afa(0x11d)),this[_0x5b0afa(0x142)]=_0x631596[_0x5b0afa(0x142)]||_0x631596[_0x5b0afa(0x107)]==_0x5b0afa(0x101)?'id':null,this[_0x5b0afa(0x12b)]=settings[_0x5b0afa(0x12f)],this[_0x5b0afa(0x10c)]=settings['batchPollingInterval']||0xfa0,this['pollingTimeoutMs']=settings['batchPollingTimeout']||0x3e8*0x3c*0xa*0xa+0xea60,this['jobId']=null,this[_0x5b0afa(0x145)]=![],this['timeoutHandle']=null;}async[a25_0x286b2e(0x123)](_0x17a06d=0x1){const _0x18aeeb=a25_0x286b2e;if(this[_0x18aeeb(0xdd)]){console['warn'](_0x18aeeb(0x111)+this[_0x18aeeb(0xdd)]+_0x18aeeb(0xcf));return;}const _0x504a1a={'object':this[_0x18aeeb(0xf7)],'operation':this['operation']};this[_0x18aeeb(0x142)]&&(_0x504a1a[_0x18aeeb(0x142)]=this[_0x18aeeb(0x142)]);console[_0x18aeeb(0x112)](_0x18aeeb(0xff)+JSON['stringify'](_0x504a1a));try{const _0x3b0f54=await sfAxios['post'](_0x18aeeb(0xe0)+this[_0x18aeeb(0x12b)]+_0x18aeeb(0x149),_0x504a1a,{});this[_0x18aeeb(0xdd)]=_0x3b0f54[_0x18aeeb(0x106)]['id'],console[_0x18aeeb(0x112)](_0x18aeeb(0x146)+this[_0x18aeeb(0xdd)]);}catch(_0x201393){if(_0x17a06d===0x1&&_0x201393[_0x18aeeb(0x114)]&&_0x201393[_0x18aeeb(0x114)][_0x18aeeb(0x147)]==0x190&&_0x201393[_0x18aeeb(0x114)][_0x18aeeb(0xd7)]==_0x18aeeb(0xfd)&&this[_0x18aeeb(0x107)]===_0x18aeeb(0x121))return console['warn'](_0x18aeeb(0x131)),this[_0x18aeeb(0x107)]='delete',this[_0x18aeeb(0x145)]=!![],await this[_0x18aeeb(0x123)](_0x17a06d+0x1);else{_0x17a06d>0x1&&console[_0x18aeeb(0xdf)](_0x18aeeb(0x13b));throw _0x201393;}}}async[a25_0x286b2e(0x130)](_0x2eca88=this['jobId']){const _0x53b205=a25_0x286b2e;try{const _0x28f94a=await sfAxios[_0x53b205(0xe8)]('/services/data/v'+this[_0x53b205(0x12b)]+_0x53b205(0xee)+_0x2eca88,{});return _0x28f94a[_0x53b205(0x106)];}catch(_0x1a298a){return console[_0x53b205(0x139)](_0x53b205(0x12a),_0x1a298a),null;}}async[a25_0x286b2e(0xd9)](_0x279303){const _0x5aa989=a25_0x286b2e;try{const _0x288127=objectToSfCsvStream(_0x279303),_0x5bf26b=await uploadData(instanceUrl,this[_0x5aa989(0xdd)],sfAxiosWrapper[_0x5aa989(0x133)],_0x288127);return console[_0x5aa989(0x112)]('upload\x20response',_0x5bf26b),_0x5bf26b;}catch(_0x5d7630){console['error'](_0x5aa989(0xfb),_0x5d7630);throw new Error(_0x5aa989(0xf3)+_0x5d7630);}}async[a25_0x286b2e(0xd6)](_0x111d65){const _0xf2659b=a25_0x286b2e;try{const _0x22c457=await objectToSfCsv(_0x111d65),_0x42cfb3=_0x22c457[_0xf2659b(0x102)]('\x0a')[_0xf2659b(0xd3)](0x0,0x5);console[_0xf2659b(0x112)](_0xf2659b(0xda)+_0x42cfb3['join']('\x0a'));try{const _0x390b8c=await sfAxios[_0xf2659b(0x117)](_0xf2659b(0xe0)+this['apiVersion']+'/jobs/ingest/'+this[_0xf2659b(0xdd)]+_0xf2659b(0x12c),_0x22c457,{'headers':{'Content-Type':_0xf2659b(0xe9)}});return _0x390b8c[_0xf2659b(0x106)];}catch(_0x19d686){return console[_0xf2659b(0x139)](_0xf2659b(0xfb),_0x19d686),null;}}catch(_0x189002){return console['error'](_0xf2659b(0x137),_0x189002),null;}}async[a25_0x286b2e(0xf4)](_0x2cf8b6=this[a25_0x286b2e(0xdd)]){const _0x102839=a25_0x286b2e;return await this['abortComplete'](_0x2cf8b6,_0x102839(0xe7));}async[a25_0x286b2e(0x11e)](_0x5876ce=this[a25_0x286b2e(0xdd)]){const _0x5e7433=a25_0x286b2e;return await this[_0x5e7433(0x13a)](_0x5876ce,_0x5e7433(0xe6));}async[a25_0x286b2e(0x13a)](_0x2ec35c=this['jobId'],_0x4c5933){const _0x51f056=a25_0x286b2e,_0x91715={'state':_0x4c5933};try{const _0x1719c3=await sfAxios['patch'](_0x51f056(0xe0)+this[_0x51f056(0x12b)]+'/jobs/ingest/'+_0x2ec35c,_0x91715,{'headers':{'Accept':_0x51f056(0x103)}});return _0x1719c3[_0x51f056(0x106)];}catch(_0x35eae7){return console[_0x51f056(0x139)]('Error\x20aborting\x20bulk\x20data\x20load\x20job:',_0x35eae7),null;}}async[a25_0x286b2e(0xe2)](_0x6b8033=this[a25_0x286b2e(0xdd)]){const _0x8e568=a25_0x286b2e;try{await sfAxios[_0x8e568(0xfa)](_0x8e568(0xe0)+this[_0x8e568(0x12b)]+'/jobs/ingest/'+_0x6b8033,{});}catch(_0x5271a3){return console['error'](_0x8e568(0xf8),_0x5271a3),null;}}async[a25_0x286b2e(0x11c)](_0xa6e608=this[a25_0x286b2e(0xdd)]){const _0x9e33b6=a25_0x286b2e;return await this[_0x9e33b6(0x124)](_0xa6e608,_0x9e33b6(0xed));}async[a25_0x286b2e(0x10b)](_0x4d8c77=this['jobId']){const _0x39dd0f=a25_0x286b2e;return await this['getResults'](_0x4d8c77,_0x39dd0f(0xd5));}async[a25_0x286b2e(0xe4)](_0x20ad39=this['jobId']){const _0x1dc7c9=a25_0x286b2e;return await this['getResults'](_0x20ad39,_0x1dc7c9(0xd1));}async[a25_0x286b2e(0x124)](_0x528456=this[a25_0x286b2e(0xdd)],_0x23a47e){const _0x381084=a25_0x286b2e;try{const _0x17af53=await sfAxios[_0x381084(0xe8)]('/services/data/v'+this[_0x381084(0x12b)]+_0x381084(0xee)+_0x528456+'/'+_0x23a47e+'/',{'responseType':_0x381084(0xfc)});return new Promise((_0x3ed190,_0x516235)=>{const _0x1f45dd=_0x381084,_0x2a0bd0=_0x17af53[_0x1f45dd(0x106)],_0x45ad34=[];_0x2a0bd0['on'](_0x1f45dd(0x106),_0x41a2c=>{_0x45ad34['push'](_0x41a2c);}),_0x2a0bd0['on'](_0x1f45dd(0xde),async()=>{const _0x573379=_0x1f45dd,_0x3a41b4=Buffer['concat'](_0x45ad34)[_0x573379(0x12e)](_0x573379(0x110)),_0x3ec38f=await sfCsvToObject(_0x3a41b4);console[_0x573379(0x112)](_0x3ec38f['length']),console['log'](_0x573379(0x141),_0x3ec38f),_0x3ed190(_0x3ec38f);});});}catch(_0x34e8de){return console[_0x381084(0x139)](_0x381084(0xf2)+_0x23a47e+':',_0x34e8de),null;}}async[a25_0x286b2e(0x105)](_0x16c157=this[a25_0x286b2e(0xdd)]){const _0x3caf70=a25_0x286b2e,_0x31b3f3=this['getSuccessfulResults'](_0x16c157),_0x51dc83=this[_0x3caf70(0x10b)](_0x16c157),_0x471405=this[_0x3caf70(0xe4)](_0x16c157);try{const [_0x574f7d,_0x16c3e9,_0x239479]=await Promise['all']([_0x31b3f3,_0x51dc83,_0x471405]);return{'successfulResults':_0x574f7d,'failedResults':_0x16c3e9,'unprocessedRecords':_0x239479};}catch(_0x45f115){return console['log'](_0x3caf70(0x122),_0x45f115),null;}}[a25_0x286b2e(0x125)](_0x5948c6,_0x4f77ce){const _0x19a1c1=a25_0x286b2e,_0x9f698e=[..._0x4f77ce[_0x19a1c1(0xed)][_0x19a1c1(0x13d)](_0x4c53af=>_0x4c53af[_0x19a1c1(0x126)]?_0x4c53af[_0x19a1c1(0x126)]:_0x4c53af['id'])[_0x19a1c1(0x135)](Boolean),..._0x4f77ce[_0x19a1c1(0xed)][_0x19a1c1(0x13d)](_0x4b4fee=>_0x4b4fee['id']&&_0x4b4fee['id']!==_0x4b4fee['sf__Id']?_0x4b4fee['id']:null)[_0x19a1c1(0x135)](Boolean),..._0x4f77ce[_0x19a1c1(0xd5)]['map'](_0x48bf90=>_0x48bf90[_0x19a1c1(0x126)]?_0x48bf90[_0x19a1c1(0x126)]:_0x48bf90['id'])[_0x19a1c1(0x135)](Boolean),..._0x4f77ce['unprocessedRecords'][_0x19a1c1(0x13d)](_0x38dfb7=>_0x38dfb7['id'])['filter'](Boolean)],_0x4fef43=_0x4f77ce['successfulResults'][_0x19a1c1(0x115)]+_0x4f77ce['failedResults'][_0x19a1c1(0x115)]+_0x4f77ce[_0x19a1c1(0x11b)]['length'],_0x58fc8=[];return console[_0x19a1c1(0x112)]('Total\x20Res\x20counts\x20'+_0x4fef43),_0x5948c6['forEach'](_0x180b31=>{const _0x58397b=_0x19a1c1,_0xceff5a=_0x180b31['id'];if(!_0xceff5a){console[_0x58397b(0x139)](_0x58397b(0xe3));return;}!_0x9f698e[_0x58397b(0x128)](_0xceff5a)&&_0x58fc8[_0x58397b(0xeb)](_0xceff5a);}),_0x58fc8[_0x19a1c1(0x115)]&&console['error'](_0x19a1c1(0x104)+_0x58fc8[_0x19a1c1(0x115)]+'\x20out\x20of\x20'+_0x5948c6[_0x19a1c1(0x115)]+'\x20original\x20records.'),_0x58fc8;}async[a25_0x286b2e(0x109)](_0x35fbd8=requiredParam(a25_0x286b2e(0x11a))){const _0x3128e2=a25_0x286b2e;let _0x19c39b=_0x35fbd8?_0x35fbd8[_0x3128e2(0x115)]:0x0,_0x256286,_0x2a4d1a,_0x65fa19=[];return new Promise(async(_0x28a8cc,_0x8ba1c0)=>{const _0x5b1745=_0x3128e2,_0x44cc46=new Date();try{console[_0x5b1745(0x112)](_0x5b1745(0x143)),await this[_0x5b1745(0x123)]();try{console['log']('===\x20Uploading\x20job\x20csv...');const _0x3c6d71=await this['uploadJobdataStream'](_0x35fbd8);console[_0x5b1745(0x112)](_0x5b1745(0x138),_0x3c6d71);let _0xece908=![];this['timeoutHandle']=setTimeout(async()=>{const _0x1d8250=_0x5b1745;_0xece908=!![],_0x256286=await this[_0x1d8250(0x130)](),console[_0x1d8250(0x139)]('!!!\x20The\x20maximum\x20bulk\x20data\x20load\x20timeout\x20has\x20been\x20reached\x20(Timeout='+this[_0x1d8250(0x134)]/0x3e8+_0x1d8250(0xf9)+((new Date()[_0x1d8250(0xf1)]()-_0x44cc46[_0x1d8250(0xf1)]())/0x3e8)[_0x1d8250(0x13e)](0x1)+_0x1d8250(0xd0),_0x256286);const _0x39f9f2=await this[_0x1d8250(0xf4)]();await sleep(0x7d0),_0x256286=await this[_0x1d8250(0x130)](),_0x2a4d1a=await this[_0x1d8250(0x105)](),_0x65fa19=this['findMissingResultSfids'](_0x35fbd8,_0x2a4d1a),_0x28a8cc({'jobInfo':_0x256286,'results':_0x2a4d1a,'coercedToStandardDelete':this[_0x1d8250(0x145)],'initialCount':_0x19c39b,'missingFromResultSfids':_0x65fa19,'timedOut':!![],'startTs':_0x44cc46,'endTs':new Date()});},this[_0x5b1745(0x134)]);try{console['log'](_0x5b1745(0xf0));const _0x305330=await this[_0x5b1745(0x11e)]();console['log']('closeData\x20=>\x20',_0x305330);try{_0x256286=_0x305330;if(_0x256286[_0x5b1745(0x118)]=='Open'){await sleep(this[_0x5b1745(0x10c)]*0x2),_0x256286=await this[_0x5b1745(0x130)]();if(_0x256286['state']==_0x5b1745(0xd2))throw new Error(_0x5b1745(0x11f));}while(_0x256286['state']==_0x5b1745(0xe6)||_0x256286[_0x5b1745(0x118)]==_0x5b1745(0xfe)){if(_0xece908)return;await sleep(this[_0x5b1745(0x10c)]),_0x256286=await this[_0x5b1745(0x130)]();}clearTimeout(this[_0x5b1745(0xf5)]);if(_0xece908)return;_0x2a4d1a=await this[_0x5b1745(0x105)]();process['env'][_0x5b1745(0xef)]&&Math[_0x5b1745(0x120)](Math['random']()*0x2)==0x0&&(console[_0x5b1745(0xdf)](_0x5b1745(0x12d)),_0x2a4d1a[_0x5b1745(0xed)][_0x5b1745(0xd3)](0x0,0x5));const _0x5eb564=new Date(),_0x1a3ecb=((_0x5eb564[_0x5b1745(0xf1)]()-_0x44cc46[_0x5b1745(0xf1)]())/0x3e8)[_0x5b1745(0x13e)](0x1);console['log'](_0x5b1745(0x100)+_0x1a3ecb+_0x5b1745(0x10d)+this[_0x5b1745(0xf7)]+_0x5b1745(0xd4)+_0x256286['state']+_0x5b1745(0x136),_0x256286),_0x65fa19=this[_0x5b1745(0x125)](_0x35fbd8,_0x2a4d1a),_0x28a8cc({'jobInfo':_0x256286,'results':_0x2a4d1a,'coercedToStandardDelete':this['coercedToStandardDelete'],'initialCount':_0x19c39b,'missingFromResultSfids':_0x65fa19,'startTs':_0x44cc46,'endTs':new Date()});}catch(_0x32baed){_0x8ba1c0(_0x32baed),console[_0x5b1745(0x139)]('Error\x20waiting\x20for\x20bulk\x20data\x20load\x20job\x20to\x20complete:\x20',_0x32baed['message']);}}catch(_0x4bd17b){_0x8ba1c0(_0x4bd17b),console[_0x5b1745(0x139)](_0x5b1745(0x144),_0x4bd17b['message']);}}catch(_0x54171d){_0x8ba1c0(_0x54171d),console[_0x5b1745(0x139)](_0x5b1745(0xf3),_0x54171d[_0x5b1745(0xe5)]);}}catch(_0x18d515){_0x8ba1c0(_0x18d515),console[_0x5b1745(0x139)](_0x5b1745(0xf6),_0x18d515[_0x5b1745(0xe5)]);}_0x28a8cc({'jobInfo':_0x256286,'results':_0x2a4d1a,'coercedToStandardDelete':this[_0x5b1745(0x145)],'initialCount':_0x19c39b,'missingFromResultSfids':_0x65fa19,'startTs':_0x44cc46,'endTs':new Date()});});}}exports=module[a25_0x286b2e(0x140)]=Bulk2Job;function a25_0x2ac8(){const _0x2a6e94=['uploadJobdataStream','First\x205\x20lines\x20of\x20csv\x20data\x20(incl\x20header):\x0a','488436cfCqfy','./https-wrapper.js','jobId','end','warn','/services/data/v','2003328MVVVQK','deleteJob','Row\x20was\x20missing\x20sfid\x20in\x20the\x20objArr.','getUnprocessedRecords','message','UploadComplete','Aborted','get','text/csv','SF_INSTANCE_URL','push','../../utils/sleep','successfulResults','/jobs/ingest/','FORCE_BULK_RESULT_REMOVALS_TEST','===\x20Closing\x20job...','getTime','Error\x20getting\x20results\x20for\x20bulk\x20data\x20load\x20job\x20resultType:\x20','Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:\x20','abortJob','timeoutHandle','Error\x20creating\x20bulk\x20data\x20load\x20job:\x20','object','Error\x20deleting\x20bulk\x20data\x20load\x20job:','\x20sec).\x20Aborting\x20job\x20after\x20','delete','Error\x20uploading\x20bulk\x20data\x20load\x20job\x20csv:','stream','Bad\x20Request','InProgress','createJob\x20body\x20=>\x20','Bulk\x20data\x20load\x20job\x20completed\x20after\x20','upsert','split','application/json','Bulk\x20job\x20was\x20missing\x20records\x20from\x20its\x20results!\x20','getAllResults','data','operation','./sf-axios-wrapper','runFullBulkJobFlow','options.object','getFailedResults','pollingMs','\x20seconds\x20on\x20OBJECT:\x20','SF_REFRESH_TOKEN','../../settings','utf-8','Attempted\x20to\x20create\x20job\x20','log','2532456RMGnSJ','response','length','259222KkFEMJ','put','state','SF_LOGIN_URL','objArr','unprocessedRecords','getSuccessfulResults','options.operation','closeJob','Bulk\x20data\x20load\x20job\x20is\x20still\x20open\x20after\x20attempting\x20to\x20mark\x20it\x20upload\x20closed.\x20This\x20should\x20not\x20happen.','floor','hardDelete','Error\x20retrieving\x20one\x20or\x20more\x20result\x20types\x20for\x20bulk\x20data\x20load\x20job:','createJob','getResults','findMissingResultSfids','sf__Id','102kkBQbB','includes','250645NzEvjq','Error\x20retrieving\x20bulk\x20data\x20load\x20job\x20info:','apiVersion','/batches','--\x20FORCE\x20REMOVING\x205\x20entries\x20from\x20bulk\x20successfulResults.\x20--','toString','sfApiVersion','getJobInfo','Initial\x20attempt\x20to\x20create\x20a\x20bulk\x20job\x20with\x20operation\x20hardDelete\x20has\x20failed\x20and\x20has\x20been\x20defaulted\x20to\x20standard\x20delete.\x20This\x20likely\x20means\x20the\x20Hard\x20Delete\x20administrative\x20permission\x20is\x20not\x20enabled\x20for\x20the\x20PC\x20SF\x20user.','19355xEltRN','accessToken','pollingTimeoutMs','filter',',\x20jobInfo\x20=>\x20','Error\x20parsing\x20bulk\x20data\x20load\x20object\x20array\x20into\x20csv:','uploadResData\x20=>\x20','error','abortComplete','createJob\x20failed\x20on\x20a\x20retry,\x20this\x20should\x20not\x20happen!','984004ZIwrYr','map','toFixed','env','exports','object\x20array','externalIdFieldName','===\x20Creating\x20new\x20job...','Error\x20closing\x20bulk\x20data\x20load\x20job\x20after\x20upload:\x20','coercedToStandardDelete','Job\x20created\x20with\x20id:\x20','status','./sf-csv-utils','/jobs/ingest','\x20twice,\x20will\x20not\x20create\x20again.','\x20seconds.\x20Current\x20bulk\x20data\x20load\x20job\x20info\x20=>','unprocessedrecords','Open','splice',',\x20STATE:\x20','failedResults','uploadJobData','statusText','3SbIAQq'];a25_0x2ac8=function(){return _0x2a6e94;};return a25_0x2ac8();}
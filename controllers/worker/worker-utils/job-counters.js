const a8_0x58040f=a8_0x12fb;(function(_0x3bd36a,_0x157fb9){const _0x4696d3=a8_0x12fb,_0x3a6cfa=_0x3bd36a();while(!![]){try{const _0x21a0c7=-parseInt(_0x4696d3(0x1ab))/0x1+parseInt(_0x4696d3(0x195))/0x2*(parseInt(_0x4696d3(0x198))/0x3)+-parseInt(_0x4696d3(0x1b2))/0x4*(parseInt(_0x4696d3(0x194))/0x5)+parseInt(_0x4696d3(0x1a0))/0x6*(-parseInt(_0x4696d3(0x1a5))/0x7)+-parseInt(_0x4696d3(0x19c))/0x8+parseInt(_0x4696d3(0x19b))/0x9+-parseInt(_0x4696d3(0x1a3))/0xa*(-parseInt(_0x4696d3(0x18d))/0xb);if(_0x21a0c7===_0x157fb9)break;else _0x3a6cfa['push'](_0x3a6cfa['shift']());}catch(_0x26d131){_0x3a6cfa['push'](_0x3a6cfa['shift']());}}}(a8_0x4d74,0x87c75));const requiredParam=require(a8_0x58040f(0x1a4)),{InvalidCounterOperationError,InvalidJobStatusError}=require(a8_0x58040f(0x18e)),DBModel=require(a8_0x58040f(0x1ae)),phaseJobMap=require(a8_0x58040f(0x19f)),db=new DBModel(),validOperations=[a8_0x58040f(0x19a),a8_0x58040f(0x1a7)],jobStatusFields={'submitted':a8_0x58040f(0x193),'successful_sub':'successful_sub\x20bigint\x20DEFAULT\x200','failed_sub':a8_0x58040f(0x18f),'failed':'failed\x20bigint\x20DEFAULT\x200','failed_all':a8_0x58040f(0x1a2),'stalled':a8_0x58040f(0x19e),'completed':a8_0x58040f(0x1a9)};function generateOperationExpr(_0x349839,_0x180d65){const _0x24b383=a8_0x58040f;let _0x111d9f;switch(_0x349839){case'INCREMENT':_0x111d9f=db[_0x24b383(0x196)](_0x24b383(0x18b),_0x180d65,_0x180d65);break;case _0x24b383(0x1a7):_0x111d9f=db[_0x24b383(0x196)](_0x24b383(0x192),_0x180d65,_0x180d65);break;default:throw new InvalidCounterOperationError(_0x24b383(0x1a1)+_0x349839);}return _0x111d9f;}function isValidOperation(_0x3ffc48){const _0x27347d=a8_0x58040f;return validOperations[_0x27347d(0x1aa)](_0x3ffc48);}function isValidJobStatus(_0x104d24){const _0xcfd5af=a8_0x58040f;return Object[_0xcfd5af(0x1b0)](jobStatusFields)[_0xcfd5af(0x1aa)](_0x104d24);}function a8_0x4d74(){const _0x562fad=['%I\x20=\x20%I\x20-\x201','submitted\x20bigint\x20DEFAULT\x200','840365mSMryw','279010GBrDFa','format','getQuery','9qqFFpQ','join','INCREMENT','5498532gTTyBR','5204792PnIFNt','map','stalled\x20bigint\x20DEFAULT\x200','./job-phase-map','4362Joanhp','Invalid\x20counter\x20operation:\x20','failed_all\x20bigint\x20DEFAULT\x200','197230CHLrxB','../../../utils/required-param','5201VIyavL','log','DECREMENT','Counter\x20update\x20query\x20failed!\x20jobType:\x20','completed\x20bigint\x20DEFAULT\x200','includes','1096215fzOvzo','rows','select\x20*\x20from\x20config.job_counters\x20where\x20execution_id\x20=\x20','../../../models/database','\x20operation:\x20','keys','jobStatus','8hWEVPz','error','%I\x20=\x20%I\x20+\x201','\x20AND\x20job_type\x20IN\x20(','1199bJTQbl','../../../errors','failed_sub\x20bigint\x20DEFAULT\x200','exports','Invalid\x20jobStatus:\x20'];a8_0x4d74=function(){return _0x562fad;};return a8_0x4d74();}function a8_0x12fb(_0x107e1d,_0x19f7c6){const _0x4d7440=a8_0x4d74();return a8_0x12fb=function(_0x12fbf6,_0x3d6094){_0x12fbf6=_0x12fbf6-0x18b;let _0x4f9b29=_0x4d7440[_0x12fbf6];return _0x4f9b29;},a8_0x12fb(_0x107e1d,_0x19f7c6);}async function updateJobCounter(_0x380590=requiredParam('executionId'),_0xb25127=requiredParam('jobType'),_0x365faf=requiredParam(a8_0x58040f(0x1b1)),_0x126a87=requiredParam('operation')){const _0x4d56da=a8_0x58040f;if(!isValidJobStatus(_0x365faf))throw new InvalidJobStatusError(_0x4d56da(0x191)+_0x365faf);if(!isValidOperation(_0x126a87))throw new InvalidCounterOperationError(_0x4d56da(0x1a1)+_0x126a87);const _0x4ad0d7=generateOperationExpr(_0x126a87,_0x365faf),_0x31c2d0='UPDATE\x20config.job_counters\x20SET\x20'+_0x4ad0d7+'\x20WHERE\x20execution_id\x20=\x20$1\x20and\x20job_type\x20=\x20$2;',_0x1ca1e6=[_0x380590,_0xb25127];try{await db['updateQuery'](_0x31c2d0,_0x1ca1e6);}catch(_0x122c28){console[_0x4d56da(0x1b3)](_0x4d56da(0x1a8)+_0xb25127+'\x20jobStatus:\x20'+_0x365faf+'\x20executionId:\x20'+_0x380590+_0x4d56da(0x1af)+_0x126a87);}}async function getJobCountsByPhaseAndExecutionId(_0x58c5de,_0x1fa5a2){const _0x118b29=a8_0x58040f,_0xe14dc4=phaseJobMap[_0x58c5de][_0x118b29(0x19d)](_0x47086f=>'\x27'+_0x47086f+'\x27')[_0x118b29(0x199)](',\x20'),_0x4c116a=_0x118b29(0x1ad)+_0x1fa5a2+_0x118b29(0x18c)+_0xe14dc4+');';console[_0x118b29(0x1a6)]('Get\x20counts\x20by\x20ExecId\x20and\x20Phase\x20query\x20generated:\x20'+_0x4c116a);const _0x307b27={};for(const _0x1b1da2 of Object[_0x118b29(0x1b0)](jobStatusFields)){_0x307b27[_0x1b1da2]=0x0;}const _0x1ea98e=await db[_0x118b29(0x197)](_0x4c116a);return _0x1ea98e[_0x118b29(0x1ac)]['forEach'](_0x3752d5=>{const _0x4a55f8=_0x118b29;for(const _0xe5d837 of Object[_0x4a55f8(0x1b0)](jobStatusFields)){_0x307b27[_0xe5d837]+=parseInt(_0x3752d5[_0xe5d837]);}}),_0x307b27;}module[a8_0x58040f(0x190)]={'jobStatusFields':jobStatusFields,'updateJobCounter':updateJobCounter,'getJobCountsByPhaseAndExecutionId':getJobCountsByPhaseAndExecutionId};
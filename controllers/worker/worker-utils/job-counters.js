const a8_0x41525c=a8_0x46fc;function a8_0x46fc(_0x4bd3cb,_0x1397cb){const _0x5b41d6=a8_0x5b41();return a8_0x46fc=function(_0x46fcdc,_0x49f4d9){_0x46fcdc=_0x46fcdc-0x109;let _0x3c5451=_0x5b41d6[_0x46fcdc];return _0x3c5451;},a8_0x46fc(_0x4bd3cb,_0x1397cb);}function a8_0x5b41(){const _0x2ea549=['error','updateQuery','1578099gEWLXM','10ztZSnY','4HPebcT','successful_sub\x20bigint\x20DEFAULT\x200','keys','\x20WHERE\x20execution_id\x20=\x20$1\x20and\x20job_type\x20=\x20$2;','4UrWdru','forEach','160zCxfuf','Get\x20counts\x20by\x20ExecId\x20and\x20Phase\x20query\x20generated:\x20','failed_sub\x20bigint\x20DEFAULT\x200','DECREMENT','162498aGrbql','\x20executionId:\x20','log','join','2122866gTLTzx','format','includes','495534YqeuYn','../../../models/database','stalled\x20bigint\x20DEFAULT\x200','5943468hNjGCc','submitted\x20bigint\x20DEFAULT\x200','Invalid\x20counter\x20operation:\x20','./job-phase-map','5MYqZtk','map','rows','jobType','Invalid\x20jobStatus:\x20','executionId','7108079ZfwKVo','299926BxBQST','failed_all\x20bigint\x20DEFAULT\x200','%I\x20=\x20%I\x20+\x201','INCREMENT','getQuery','\x20jobStatus:\x20','\x20AND\x20job_type\x20IN\x20(','exports'];a8_0x5b41=function(){return _0x2ea549;};return a8_0x5b41();}(function(_0x20e2cb,_0x28be58){const _0x4345d5=a8_0x46fc,_0x5d908f=_0x20e2cb();while(!![]){try{const _0x4a221d=parseInt(_0x4345d5(0x125))/0x1*(parseInt(_0x4345d5(0x115))/0x2)+-parseInt(_0x4345d5(0x11f))/0x3*(parseInt(_0x4345d5(0x121))/0x4)+-parseInt(_0x4345d5(0x10e))/0x5*(parseInt(_0x4345d5(0x132))/0x6)+parseInt(_0x4345d5(0x12b))/0x7*(-parseInt(_0x4345d5(0x127))/0x8)+-parseInt(_0x4345d5(0x12f))/0x9+parseInt(_0x4345d5(0x120))/0xa*(parseInt(_0x4345d5(0x114))/0xb)+parseInt(_0x4345d5(0x10a))/0xc;if(_0x4a221d===_0x28be58)break;else _0x5d908f['push'](_0x5d908f['shift']());}catch(_0x357528){_0x5d908f['push'](_0x5d908f['shift']());}}}(a8_0x5b41,0x699aa));const requiredParam=require('../../../utils/required-param'),{InvalidCounterOperationError,InvalidJobStatusError}=require('../../../errors'),DBModel=require(a8_0x41525c(0x133)),phaseJobMap=require(a8_0x41525c(0x10d)),db=new DBModel(),validOperations=[a8_0x41525c(0x118),a8_0x41525c(0x12a)],jobStatusFields={'submitted':a8_0x41525c(0x10b),'successful_sub':a8_0x41525c(0x122),'failed_sub':a8_0x41525c(0x129),'failed':'failed\x20bigint\x20DEFAULT\x200','failed_all':a8_0x41525c(0x116),'stalled':a8_0x41525c(0x109),'completed':'completed\x20bigint\x20DEFAULT\x200'};function generateOperationExpr(_0x4c0a07,_0x5aef3b){const _0x45e8ce=a8_0x41525c;let _0x41ac17;switch(_0x4c0a07){case'INCREMENT':_0x41ac17=db[_0x45e8ce(0x130)](_0x45e8ce(0x117),_0x5aef3b,_0x5aef3b);break;case'DECREMENT':_0x41ac17=db[_0x45e8ce(0x130)]('%I\x20=\x20%I\x20-\x201',_0x5aef3b,_0x5aef3b);break;default:throw new InvalidCounterOperationError(_0x45e8ce(0x10c)+_0x4c0a07);}return _0x41ac17;}function isValidOperation(_0x548ec3){const _0xa35d70=a8_0x41525c;return validOperations[_0xa35d70(0x131)](_0x548ec3);}function isValidJobStatus(_0x4e9150){const _0x12fb80=a8_0x41525c;return Object[_0x12fb80(0x123)](jobStatusFields)[_0x12fb80(0x131)](_0x4e9150);}async function updateJobCounter(_0x55d557=requiredParam(a8_0x41525c(0x113)),_0x58ce9c=requiredParam(a8_0x41525c(0x111)),_0xd25df6=requiredParam('jobStatus'),_0x182e18=requiredParam('operation')){const _0x4e1249=a8_0x41525c;if(!isValidJobStatus(_0xd25df6))throw new InvalidJobStatusError(_0x4e1249(0x112)+_0xd25df6);if(!isValidOperation(_0x182e18))throw new InvalidCounterOperationError(_0x4e1249(0x10c)+_0x182e18);const _0x572311=generateOperationExpr(_0x182e18,_0xd25df6),_0x4488f6='UPDATE\x20config.job_counters\x20SET\x20'+_0x572311+_0x4e1249(0x124),_0x269289=[_0x55d557,_0x58ce9c];try{await db[_0x4e1249(0x11e)](_0x4488f6,_0x269289);}catch(_0x283b29){console[_0x4e1249(0x11d)]('Counter\x20update\x20query\x20failed!\x20jobType:\x20'+_0x58ce9c+_0x4e1249(0x11a)+_0xd25df6+_0x4e1249(0x12c)+_0x55d557+'\x20operation:\x20'+_0x182e18);}}async function getJobCountsByPhaseAndExecutionId(_0x56d4a5,_0x4ab853){const _0xbe9737=a8_0x41525c,_0x2d84bc=phaseJobMap[_0x56d4a5][_0xbe9737(0x10f)](_0x4350a0=>'\x27'+_0x4350a0+'\x27')[_0xbe9737(0x12e)](',\x20'),_0x4d763a='select\x20*\x20from\x20config.job_counters\x20where\x20execution_id\x20=\x20'+_0x4ab853+_0xbe9737(0x11b)+_0x2d84bc+');';console[_0xbe9737(0x12d)](_0xbe9737(0x128)+_0x4d763a);const _0x176d3f={};for(const _0x2e2b8b of Object['keys'](jobStatusFields)){_0x176d3f[_0x2e2b8b]=0x0;}const _0x148927=await db[_0xbe9737(0x119)](_0x4d763a);return _0x148927[_0xbe9737(0x110)][_0xbe9737(0x126)](_0x3bbaac=>{const _0x5f1ba7=_0xbe9737;for(const _0x595ce3 of Object[_0x5f1ba7(0x123)](jobStatusFields)){_0x176d3f[_0x595ce3]+=parseInt(_0x3bbaac[_0x595ce3]);}}),_0x176d3f;}module[a8_0x41525c(0x11c)]={'jobStatusFields':jobStatusFields,'updateJobCounter':updateJobCounter,'getJobCountsByPhaseAndExecutionId':getJobCountsByPhaseAndExecutionId};
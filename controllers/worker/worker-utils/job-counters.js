const a8_0x4f695b=a8_0x5ddd;(function(_0x6c5322,_0x34e801){const _0x235b96=a8_0x5ddd,_0x31a54f=_0x6c5322();while(!![]){try{const _0x3d89d6=-parseInt(_0x235b96(0xc3))/0x1*(-parseInt(_0x235b96(0xb1))/0x2)+-parseInt(_0x235b96(0xb9))/0x3*(-parseInt(_0x235b96(0xc7))/0x4)+-parseInt(_0x235b96(0xb5))/0x5*(parseInt(_0x235b96(0xb4))/0x6)+parseInt(_0x235b96(0xb6))/0x7*(parseInt(_0x235b96(0xc2))/0x8)+-parseInt(_0x235b96(0xbb))/0x9*(parseInt(_0x235b96(0xcd))/0xa)+parseInt(_0x235b96(0xca))/0xb*(-parseInt(_0x235b96(0xc8))/0xc)+-parseInt(_0x235b96(0xcc))/0xd;if(_0x3d89d6===_0x34e801)break;else _0x31a54f['push'](_0x31a54f['shift']());}catch(_0x2f62f8){_0x31a54f['push'](_0x31a54f['shift']());}}}(a8_0x2b00,0xb1e8f));const requiredParam=require(a8_0x4f695b(0xc4)),{InvalidCounterOperationError,InvalidJobStatusError}=require(a8_0x4f695b(0xb0)),DBModel=require(a8_0x4f695b(0xa7)),phaseJobMap=require(a8_0x4f695b(0xa6)),db=new DBModel(),validOperations=['INCREMENT',a8_0x4f695b(0xcf)],jobStatusFields={'submitted':a8_0x4f695b(0xab),'successful_sub':a8_0x4f695b(0xbf),'failed_sub':'failed_sub\x20bigint\x20DEFAULT\x200','failed':a8_0x4f695b(0xbc),'failed_all':a8_0x4f695b(0xad),'stalled':a8_0x4f695b(0xaf),'completed':'completed\x20bigint\x20DEFAULT\x200'};function generateOperationExpr(_0x1cce9c,_0x8dcfeb){const _0x3741af=a8_0x4f695b;let _0x181393;switch(_0x1cce9c){case'INCREMENT':_0x181393=db['format'](_0x3741af(0xbd),_0x8dcfeb,_0x8dcfeb);break;case _0x3741af(0xcf):_0x181393=db['format']('%I\x20=\x20%I\x20-\x201',_0x8dcfeb,_0x8dcfeb);break;default:throw new InvalidCounterOperationError('Invalid\x20counter\x20operation:\x20'+_0x1cce9c);}return _0x181393;}function a8_0x2b00(){const _0x2a1964=['19179AiaONi','failed\x20bigint\x20DEFAULT\x200','%I\x20=\x20%I\x20+\x201','updateQuery','successful_sub\x20bigint\x20DEFAULT\x200','\x20WHERE\x20execution_id\x20=\x20$1\x20and\x20job_type\x20=\x20$2;','\x20jobStatus:\x20','2573776XWXJfj','25969kCGpRN','../../../utils/required-param','executionId','forEach','712ENXmWW','12xnkOIG','jobType','8704894ioUPPz','operation','7994571jNeFUj','300UuDFDf','keys','DECREMENT','map','UPDATE\x20config.job_counters\x20SET\x20','./job-phase-map','../../../models/database','\x20operation:\x20','error','Invalid\x20counter\x20operation:\x20','submitted\x20bigint\x20DEFAULT\x200','getQuery','failed_all\x20bigint\x20DEFAULT\x200','includes','stalled\x20bigint\x20DEFAULT\x200','../../../errors','94qbhDse','\x20executionId:\x20','\x20AND\x20job_type\x20IN\x20(','126PllenL','149965xmhDCN','21EPdkKU','select\x20*\x20from\x20config.job_counters\x20where\x20execution_id\x20=\x20','Get\x20counts\x20by\x20ExecId\x20and\x20Phase\x20query\x20generated:\x20','10839ZuJqtN','log'];a8_0x2b00=function(){return _0x2a1964;};return a8_0x2b00();}function a8_0x5ddd(_0x5e539d,_0x36237f){const _0x2b00c6=a8_0x2b00();return a8_0x5ddd=function(_0x5ddd7d,_0x413c4f){_0x5ddd7d=_0x5ddd7d-0xa5;let _0x593b1f=_0x2b00c6[_0x5ddd7d];return _0x593b1f;},a8_0x5ddd(_0x5e539d,_0x36237f);}function isValidOperation(_0x577080){const _0xd6f93c=a8_0x4f695b;return validOperations[_0xd6f93c(0xae)](_0x577080);}function isValidJobStatus(_0x5ec07f){const _0x184b2d=a8_0x4f695b;return Object[_0x184b2d(0xce)](jobStatusFields)[_0x184b2d(0xae)](_0x5ec07f);}async function updateJobCounter(_0x2d11a2=requiredParam(a8_0x4f695b(0xc5)),_0x2774b7=requiredParam(a8_0x4f695b(0xc9)),_0x31031e=requiredParam('jobStatus'),_0x5ef814=requiredParam(a8_0x4f695b(0xcb))){const _0x3431d3=a8_0x4f695b;if(!isValidJobStatus(_0x31031e))throw new InvalidJobStatusError('Invalid\x20jobStatus:\x20'+_0x31031e);if(!isValidOperation(_0x5ef814))throw new InvalidCounterOperationError(_0x3431d3(0xaa)+_0x5ef814);const _0x196801=generateOperationExpr(_0x5ef814,_0x31031e),_0x41c059=_0x3431d3(0xa5)+_0x196801+_0x3431d3(0xc0),_0x586398=[_0x2d11a2,_0x2774b7];try{await db[_0x3431d3(0xbe)](_0x41c059,_0x586398);}catch(_0x3ef224){console[_0x3431d3(0xa9)]('Counter\x20update\x20query\x20failed!\x20jobType:\x20'+_0x2774b7+_0x3431d3(0xc1)+_0x31031e+_0x3431d3(0xb2)+_0x2d11a2+_0x3431d3(0xa8)+_0x5ef814);}}async function getJobCountsByPhaseAndExecutionId(_0x5cf0b7,_0x2538ae){const _0x93c689=a8_0x4f695b,_0x55cb85=phaseJobMap[_0x5cf0b7][_0x93c689(0xd0)](_0x3d379c=>'\x27'+_0x3d379c+'\x27')['join'](',\x20'),_0x35b323=_0x93c689(0xb7)+_0x2538ae+_0x93c689(0xb3)+_0x55cb85+');';console[_0x93c689(0xba)](_0x93c689(0xb8)+_0x35b323);const _0x565a2f={};for(const _0x5efdb5 of Object[_0x93c689(0xce)](jobStatusFields)){_0x565a2f[_0x5efdb5]=0x0;}const _0x3d986e=await db[_0x93c689(0xac)](_0x35b323);return _0x3d986e['rows'][_0x93c689(0xc6)](_0x5049ad=>{const _0x3fd208=_0x93c689;for(const _0x3545fc of Object[_0x3fd208(0xce)](jobStatusFields)){_0x565a2f[_0x3545fc]+=parseInt(_0x5049ad[_0x3545fc]);}}),_0x565a2f;}module['exports']={'jobStatusFields':jobStatusFields,'updateJobCounter':updateJobCounter,'getJobCountsByPhaseAndExecutionId':getJobCountsByPhaseAndExecutionId};
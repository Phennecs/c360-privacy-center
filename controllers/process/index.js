'use strict';const a2_0x55a94d=a2_0xdf4d;(function(_0x236fd3,_0x25274){const _0x2088e6=a2_0xdf4d,_0x234988=_0x236fd3();while(!![]){try{const _0x4ed282=-parseInt(_0x2088e6(0x1c0))/0x1+parseInt(_0x2088e6(0x1b6))/0x2*(parseInt(_0x2088e6(0x1c9))/0x3)+parseInt(_0x2088e6(0x1b0))/0x4+parseInt(_0x2088e6(0x1bd))/0x5*(-parseInt(_0x2088e6(0x1a0))/0x6)+parseInt(_0x2088e6(0x1ac))/0x7+-parseInt(_0x2088e6(0x1ad))/0x8+parseInt(_0x2088e6(0x1bb))/0x9;if(_0x4ed282===_0x25274)break;else _0x234988['push'](_0x234988['shift']());}catch(_0x851c03){_0x234988['push'](_0x234988['shift']());}}}(a2_0x3618,0x8bf04));function a2_0xdf4d(_0x5dc356,_0x33bd9e){const _0x361880=a2_0x3618();return a2_0xdf4d=function(_0xdf4dc7,_0x241de7){_0xdf4dc7=_0xdf4dc7-0x19b;let _0x23b80e=_0x361880[_0xdf4dc7];return _0x23b80e;},a2_0xdf4d(_0x5dc356,_0x33bd9e);}const herokuModel=require(a2_0x55a94d(0x1d2)),SalesforceModel=require(a2_0x55a94d(0x1b4)),{handleJobSubmission}=require('../worker/worker-utils/job-gateway'),getPendingJobCount=require(a2_0x55a94d(0x1d0)),SCHED_STATUSES=require('../../models/salesforce/pc-schedule-status-map'),salesforce=new SalesforceModel(),heroku=new herokuModel();function a2_0x3618(){const _0x262dc4=['../worker/worker-utils/get-pending-job-count','data','../../models/heroku','msg','insertRunLog','Running\x20PolicyName','Policy:\x20','ERROR','status','REDIS_URL','1710582bGhlIs','Error','Error\x20updating\x20PC\x20Schedule\x20Status:','Submitting\x20policy-driver\x20job!','Missing\x20Authorization\x20Token','executionId','Unauthorized','DeveloperName','\x20could\x20not\x20be\x20queued\x20for\x20execution.\x20The\x20Redis\x20addon\x20in\x20the\x20Heroku\x20app\x20does\x20not\x20appear\x20to\x20be\x20fully\x20set\x20up.','\x20is\x20initializing.','body','ExecutionId','266245XaonxE','4424432fVwUfk','header','exports','3952032yMPEQb','\x20is\x20already\x20queued\x20for\x20execution.\x20It\x20will\x20not\x20be\x20allowed\x20in\x20the\x20queue\x20again\x20until\x20the\x20pre-existing\x20run\x20has\x20completed\x20and\x20the\x20next\x20scheduled\x20run\x20of\x20this\x20policy\x20begins.\x20If\x20this\x20message\x20occurs\x20often,\x20please\x20consider\x20reducing\x20the\x20frequency\x20of\x20this\x20policy\x27s\x20run\x20schedule.','updatePCScheduleStatus','REDIS_URL\x20is\x20not\x20set,\x20will\x20not\x20proceed!','../../models/salesforce','Error\x20during\x20auth\x20against\x20/auth\x20with\x20bearerToken.','156582TfOOcF','warn','Authorization','delayed','Failure','6863256BZUGFO','Process\x20request\x20received:\x20req.body\x20=>','10Aegkfl','some','Unable\x20to\x20authenticate\x20the\x20authorization\x20token\x20for\x20access\x20into\x20Heroku.','953392hYEqqp','json','policyName','policy-driver','Authentication\x20into\x20Heroku\x20is\x20denied.','Redis\x20URL\x20does\x20not\x20appear\x20to\x20be\x20set.\x20Not\x20proceeding.','resume','logType','../../models/queue','33sGeSlj','SKIPPED','log','waiting','Success','Cache\x20Processing','error'];a2_0x3618=function(){return _0x262dc4;};return a2_0x3618();}async function authHeroku(_0x476159,_0x1232b5,_0x1b09ad,_0x5671ca=![]){const _0x465ac6=a2_0x55a94d;if(_0x476159!=null)try{const _0x5799e2=await heroku['validateHerokuAuthHeader'](_0x476159);if(!_0x5799e2){if(!_0x5671ca)await salesforce[_0x465ac6(0x1d4)](_0x1232b5,_0x1b09ad,_0x465ac6(0x1a1),'Cache\x20Processing',_0x465ac6(0x1c4));try{await salesforce[_0x465ac6(0x1b2)](_0x1b09ad,_0x1232b5,SCHED_STATUSES[_0x465ac6(0x19d)]);}catch(_0x284ff3){console[_0x465ac6(0x1cf)](_0x465ac6(0x1a2),_0x284ff3);}return{'status':_0x465ac6(0x1a6)};}else return console[_0x465ac6(0x1cb)]('Auth\x20passed,\x20proceeding.'),{'status':'Success'};}catch(_0x266484){console[_0x465ac6(0x1cf)](_0x465ac6(0x1b5),_0x266484);if(!_0x5671ca)await salesforce['insertRunLog'](_0x1232b5,_0x1b09ad,_0x465ac6(0x1a1),_0x465ac6(0x1ce),_0x465ac6(0x1c4));try{await salesforce[_0x465ac6(0x1b2)](_0x1b09ad,_0x1232b5,SCHED_STATUSES[_0x465ac6(0x19d)]);}catch(_0x5b5afc){console[_0x465ac6(0x1cf)]('Error\x20updating\x20PC\x20Schedule\x20Status:',_0x5b5afc);}return{'status':'Unauthorized'};}else{if(!_0x5671ca)await salesforce[_0x465ac6(0x1d4)](_0x1232b5,_0x1b09ad,_0x465ac6(0x1a1),_0x465ac6(0x1ce),_0x465ac6(0x1bf));try{await salesforce[_0x465ac6(0x1b2)](_0x1b09ad,_0x1232b5,SCHED_STATUSES[_0x465ac6(0x19d)]);}catch(_0x4c2bf1){console[_0x465ac6(0x1cf)]('Error\x20updating\x20PC\x20Schedule\x20Status:',_0x4c2bf1);}return{'status':_0x465ac6(0x1a4)};}}const index=async(_0xd67249,_0x2b0921)=>{const _0x51c29b=a2_0x55a94d;console[_0x51c29b(0x1cb)](_0x51c29b(0x1bc),_0xd67249['body']);let _0x3ed718=_0xd67249[_0x51c29b(0x1ae)](_0x51c29b(0x1b8)),_0x5357ad=_0xd67249[_0x51c29b(0x1aa)][_0x51c29b(0x1ab)],_0x55ce78=_0xd67249[_0x51c29b(0x1aa)][_0x51c29b(0x1a7)];const _0x203a9a=await authHeroku(_0x3ed718,_0x5357ad,_0x55ce78);if(_0x203a9a[_0x51c29b(0x19e)]!=='Success')return console[_0x51c29b(0x1cf)]('Process\x20endpoint\x20Heroku\x20auth\x20failed!'),_0x2b0921['status'](0x191)[_0x51c29b(0x1c1)](_0x203a9a);else{let _0x5854d7,_0x12fd3a={'executionId':_0x5357ad,'policyName':_0x55ce78,'logType':_0x51c29b(0x1ce)},_0x172713={},_0x5ccf31,_0x1afdb8,_0x5df77b;if(!process['env'][_0x51c29b(0x19f)]){console['log'](_0x51c29b(0x1b3)),(_0x12fd3a[_0x51c29b(0x1d3)]=_0x51c29b(0x1ba),'Cache\x20Processing',_0x51c29b(0x19c)+_0x55ce78+_0x51c29b(0x1a8)),_0x12fd3a[_0x51c29b(0x19e)]='Failure',_0x5854d7=await salesforce[_0x51c29b(0x1d4)](_0x12fd3a[_0x51c29b(0x1a5)],_0x12fd3a[_0x51c29b(0x1c2)],_0x12fd3a[_0x51c29b(0x19e)],_0x12fd3a[_0x51c29b(0x1c7)],_0x12fd3a[_0x51c29b(0x1d3)]);try{await salesforce['updatePCScheduleStatus'](_0x55ce78,_0x5357ad,SCHED_STATUSES[_0x51c29b(0x19d)]);}catch(_0x541305){console['error'](_0x51c29b(0x1a2),_0x541305);}return _0x172713['status']=_0x51c29b(0x1c5),_0x2b0921[_0x51c29b(0x19e)](0x1f4)[_0x51c29b(0x1c1)](_0x172713);}else{({policyQueue:_0x5ccf31,nonPolicyQueues:_0x1afdb8,upStateQueue:_0x5df77b}=require(_0x51c29b(0x1c8)));const _0x15a318=await _0x5ccf31['getJobs']([_0x51c29b(0x1b9),'active',_0x51c29b(0x1cc),'paused']);console[_0x51c29b(0x1cb)](_0x51c29b(0x19b),_0x55ce78);if(_0x15a318[_0x51c29b(0x1be)](_0x13f341=>_0x13f341[_0x51c29b(0x1d1)]['policyName']==_0x55ce78)){_0x12fd3a[_0x51c29b(0x1d3)]=_0x51c29b(0x19c)+_0x55ce78+_0x51c29b(0x1b1),_0x12fd3a[_0x51c29b(0x19e)]='Failure',console[_0x51c29b(0x1b7)](_0x12fd3a['msg']),_0x172713[_0x51c29b(0x19e)]=_0x12fd3a[_0x51c29b(0x1d3)],_0x5854d7=await salesforce[_0x51c29b(0x1d4)](_0x12fd3a[_0x51c29b(0x1a5)],_0x12fd3a[_0x51c29b(0x1c2)],_0x12fd3a[_0x51c29b(0x19e)],_0x12fd3a[_0x51c29b(0x1c7)],_0x12fd3a['msg']);try{await salesforce[_0x51c29b(0x1b2)](_0x55ce78,_0x5357ad,SCHED_STATUSES[_0x51c29b(0x1ca)]);}catch(_0x443020){console[_0x51c29b(0x1cf)](_0x51c29b(0x1a2),_0x443020);}return _0x2b0921[_0x51c29b(0x19e)](0x199)[_0x51c29b(0x1c1)](_0x172713);}else{_0x12fd3a[_0x51c29b(0x1d3)]=_0x51c29b(0x19c)+_0x55ce78+_0x51c29b(0x1a9),_0x12fd3a[_0x51c29b(0x19e)]=_0x51c29b(0x1cd),_0x5854d7=await salesforce['insertRunLog'](_0x12fd3a[_0x51c29b(0x1a5)],_0x12fd3a[_0x51c29b(0x1c2)],_0x12fd3a[_0x51c29b(0x19e)],_0x12fd3a['logType'],_0x12fd3a['msg']);if(!_0x5854d7){_0x172713[_0x51c29b(0x19e)]='Initial\x20run\x20log\x20insertion\x20failure',console[_0x51c29b(0x1cf)]('Initial\x20run\x20log\x20was\x20not\x20inserted!\x20Not\x20proceeding.');try{await salesforce['updatePCScheduleStatus'](_0x55ce78,_0x5357ad,SCHED_STATUSES[_0x51c29b(0x19d)]);}catch(_0x1cc8e6){console[_0x51c29b(0x1cf)](_0x51c29b(0x1a2),_0x1cc8e6);}return _0x2b0921[_0x51c29b(0x19e)](0x1f4)[_0x51c29b(0x1c1)](_0x172713);}else{const _0x163be1=await getPendingJobCount([..._0x1afdb8,_0x5df77b]);_0x163be1?console[_0x51c29b(0x1cb)]('Pending\x20jobs\x20were\x20detected,\x20the\x20policy\x20queue\x20will\x20not\x20be\x20resumed.'):(console[_0x51c29b(0x1cb)]('No\x20pending\x20jobs\x20detected,\x20resuming\x20policy\x20queue.'),await _0x5ccf31[_0x51c29b(0x1c6)](![]));console[_0x51c29b(0x1cb)](_0x51c29b(0x1a3));const _0x56bda4=await handleJobSubmission({'queue':_0x5ccf31,'jobType':_0x51c29b(0x1c3),'jobData':{'executionId':_0x5357ad,'policyName':_0x55ce78},'skipCounters':!![]});return _0x12fd3a[_0x51c29b(0x1d3)]=_0x51c29b(0x19c)+_0x55ce78+'\x20is\x20now\x20queued\x20for\x20execution.',_0x12fd3a[_0x51c29b(0x19e)]=_0x51c29b(0x1cd),_0x172713[_0x51c29b(0x19e)]=_0x12fd3a['status'],_0x5854d7=await salesforce[_0x51c29b(0x1d4)](_0x12fd3a[_0x51c29b(0x1a5)],_0x12fd3a[_0x51c29b(0x1c2)],_0x12fd3a[_0x51c29b(0x19e)],_0x12fd3a[_0x51c29b(0x1c7)],_0x12fd3a[_0x51c29b(0x1d3)]),_0x2b0921[_0x51c29b(0x19e)](0xc8)[_0x51c29b(0x1c1)](_0x172713);}}}}};module[a2_0x55a94d(0x1af)]={'index':index,'authHeroku':authHeroku};
'use strict';function a2_0x3a53(){const _0x1c3e07=['policyName','waiting','ERROR','json','env','Unable\x20to\x20authenticate\x20the\x20authorization\x20token\x20for\x20access\x20into\x20Heroku.','Process\x20request\x20received:\x20req.body\x20=>','Initial\x20run\x20log\x20was\x20not\x20inserted!\x20Not\x20proceeding.','some','body','active','Process\x20endpoint\x20Heroku\x20auth\x20failed!','msg','Auth\x20passed,\x20proceeding.','Success','8GBVrea','getJobs','Error','1134948wOvxoD','../../models/salesforce/pc-schedule-status-map','data','paused','364838XEFWpZ','346278efJQJz','Authorization','REDIS_URL\x20is\x20not\x20set,\x20will\x20not\x20proceed!','logType','2135511GCrlhi','log','Submitting\x20policy-driver\x20job!','Running\x20PolicyName','11780QmaQCX','Failure','../worker/worker-utils/job-gateway','DeveloperName','Policy:\x20','updatePCScheduleStatus','Initial\x20run\x20log\x20insertion\x20failure','status','2313qQfxmn','Authentication\x20into\x20Heroku\x20is\x20denied.','Error\x20updating\x20PC\x20Schedule\x20Status:','\x20is\x20initializing.','exports','\x20is\x20now\x20queued\x20for\x20execution.','Unauthorized','Missing\x20Authorization\x20Token','../../models/heroku','insertRunLog','398205hZTmZR','header','executionId','Error\x20during\x20auth\x20against\x20/auth\x20with\x20bearerToken.','11384xVYdWq','error','Cache\x20Processing'];a2_0x3a53=function(){return _0x1c3e07;};return a2_0x3a53();}const a2_0x4b0c57=a2_0x9e9c;(function(_0x189085,_0x5e6f99){const _0x10f841=a2_0x9e9c,_0x33b9a6=_0x189085();while(!![]){try{const _0x14c75d=parseInt(_0x10f841(0x155))/0x1+parseInt(_0x10f841(0x156))/0x2+parseInt(_0x10f841(0x170))/0x3+parseInt(_0x10f841(0x14e))/0x4*(parseInt(_0x10f841(0x15e))/0x5)+parseInt(_0x10f841(0x151))/0x6+-parseInt(_0x10f841(0x15a))/0x7+parseInt(_0x10f841(0x174))/0x8*(-parseInt(_0x10f841(0x166))/0x9);if(_0x14c75d===_0x5e6f99)break;else _0x33b9a6['push'](_0x33b9a6['shift']());}catch(_0x42dbe4){_0x33b9a6['push'](_0x33b9a6['shift']());}}}(a2_0x3a53,0x2f506));const herokuModel=require(a2_0x4b0c57(0x16e)),SalesforceModel=require('../../models/salesforce'),{handleJobSubmission}=require(a2_0x4b0c57(0x160)),getPendingJobCount=require('../worker/worker-utils/get-pending-job-count'),SCHED_STATUSES=require(a2_0x4b0c57(0x152)),salesforce=new SalesforceModel(),heroku=new herokuModel();async function authHeroku(_0x14b3d6,_0x5c6ec2,_0x56cc21,_0x61b667=![]){const _0x1b5b3b=a2_0x4b0c57;if(_0x14b3d6!=null)try{const _0x5c07af=await heroku['validateHerokuAuthHeader'](_0x14b3d6);if(!_0x5c07af){if(!_0x61b667)await salesforce[_0x1b5b3b(0x16f)](_0x5c6ec2,_0x56cc21,_0x1b5b3b(0x150),_0x1b5b3b(0x176),_0x1b5b3b(0x167));try{await salesforce['updatePCScheduleStatus'](_0x56cc21,_0x5c6ec2,SCHED_STATUSES['ERROR']);}catch(_0x35aa02){console[_0x1b5b3b(0x175)](_0x1b5b3b(0x168),_0x35aa02);}return{'status':_0x1b5b3b(0x16c)};}else return console[_0x1b5b3b(0x15b)](_0x1b5b3b(0x14c)),{'status':_0x1b5b3b(0x14d)};}catch(_0x165275){console[_0x1b5b3b(0x175)](_0x1b5b3b(0x173),_0x165275);if(!_0x61b667)await salesforce[_0x1b5b3b(0x16f)](_0x5c6ec2,_0x56cc21,_0x1b5b3b(0x150),_0x1b5b3b(0x176),'Authentication\x20into\x20Heroku\x20is\x20denied.');try{await salesforce['updatePCScheduleStatus'](_0x56cc21,_0x5c6ec2,SCHED_STATUSES[_0x1b5b3b(0x179)]);}catch(_0x191fa0){console[_0x1b5b3b(0x175)](_0x1b5b3b(0x168),_0x191fa0);}return{'status':_0x1b5b3b(0x16c)};}else{if(!_0x61b667)await salesforce[_0x1b5b3b(0x16f)](_0x5c6ec2,_0x56cc21,_0x1b5b3b(0x150),_0x1b5b3b(0x176),_0x1b5b3b(0x17c));try{await salesforce[_0x1b5b3b(0x163)](_0x56cc21,_0x5c6ec2,SCHED_STATUSES[_0x1b5b3b(0x179)]);}catch(_0x23a0c7){console['error'](_0x1b5b3b(0x168),_0x23a0c7);}return{'status':_0x1b5b3b(0x16d)};}}const index=async(_0x42023a,_0x236d04)=>{const _0x38ba47=a2_0x4b0c57;console[_0x38ba47(0x15b)](_0x38ba47(0x17d),_0x42023a[_0x38ba47(0x148)]);let _0x14e62d=_0x42023a[_0x38ba47(0x171)](_0x38ba47(0x157)),_0x26ddb6=_0x42023a[_0x38ba47(0x148)]['ExecutionId'],_0x280744=_0x42023a[_0x38ba47(0x148)][_0x38ba47(0x161)];const _0x386a30=await authHeroku(_0x14e62d,_0x26ddb6,_0x280744);if(_0x386a30[_0x38ba47(0x165)]!=='Success')return console['error'](_0x38ba47(0x14a)),_0x236d04['status'](0x191)[_0x38ba47(0x17a)](_0x386a30);else{let _0x590581,_0x4f9056={'executionId':_0x26ddb6,'policyName':_0x280744,'logType':_0x38ba47(0x176)},_0x47b9b9={},_0x5112b4,_0x3bb6cb,_0xaca272;if(!process[_0x38ba47(0x17b)]['REDIS_URL']){console[_0x38ba47(0x15b)](_0x38ba47(0x158)),(_0x4f9056[_0x38ba47(0x14b)]='Failure','Cache\x20Processing','Policy:\x20'+_0x280744+'\x20could\x20not\x20be\x20queued\x20for\x20execution.\x20The\x20Redis\x20addon\x20in\x20the\x20Heroku\x20app\x20does\x20not\x20appear\x20to\x20be\x20fully\x20set\x20up.'),_0x4f9056[_0x38ba47(0x165)]=_0x38ba47(0x15f),_0x590581=await salesforce[_0x38ba47(0x16f)](_0x4f9056['executionId'],_0x4f9056[_0x38ba47(0x177)],_0x4f9056[_0x38ba47(0x165)],_0x4f9056['logType'],_0x4f9056[_0x38ba47(0x14b)]);try{await salesforce['updatePCScheduleStatus'](_0x280744,_0x26ddb6,SCHED_STATUSES[_0x38ba47(0x179)]);}catch(_0x2601b0){console[_0x38ba47(0x175)](_0x38ba47(0x168),_0x2601b0);}return _0x47b9b9[_0x38ba47(0x165)]='Redis\x20URL\x20does\x20not\x20appear\x20to\x20be\x20set.\x20Not\x20proceeding.',_0x236d04[_0x38ba47(0x165)](0x1f4)[_0x38ba47(0x17a)](_0x47b9b9);}else{({policyQueue:_0x5112b4,nonPolicyQueues:_0x3bb6cb,upStateQueue:_0xaca272}=require('../../models/queue'));const _0x4e085c=await _0x5112b4[_0x38ba47(0x14f)](['delayed',_0x38ba47(0x149),_0x38ba47(0x178),_0x38ba47(0x154)]);console[_0x38ba47(0x15b)](_0x38ba47(0x15d),_0x280744);if(_0x4e085c[_0x38ba47(0x147)](_0x50500f=>_0x50500f[_0x38ba47(0x153)][_0x38ba47(0x177)]==_0x280744)){_0x4f9056['msg']=_0x38ba47(0x162)+_0x280744+'\x20is\x20already\x20queued\x20for\x20execution.\x20It\x20will\x20not\x20be\x20allowed\x20in\x20the\x20queue\x20again\x20until\x20the\x20pre-existing\x20run\x20has\x20completed\x20and\x20the\x20next\x20scheduled\x20run\x20of\x20this\x20policy\x20begins.\x20If\x20this\x20message\x20occurs\x20often,\x20please\x20consider\x20reducing\x20the\x20frequency\x20of\x20this\x20policy\x27s\x20run\x20schedule.',_0x4f9056[_0x38ba47(0x165)]=_0x38ba47(0x15f),console['warn'](_0x4f9056[_0x38ba47(0x14b)]),_0x47b9b9[_0x38ba47(0x165)]=_0x4f9056['msg'],_0x590581=await salesforce[_0x38ba47(0x16f)](_0x4f9056['executionId'],_0x4f9056['policyName'],_0x4f9056[_0x38ba47(0x165)],_0x4f9056[_0x38ba47(0x159)],_0x4f9056[_0x38ba47(0x14b)]);try{await salesforce[_0x38ba47(0x163)](_0x280744,_0x26ddb6,SCHED_STATUSES['SKIPPED']);}catch(_0x5afb76){console[_0x38ba47(0x175)](_0x38ba47(0x168),_0x5afb76);}return _0x236d04['status'](0x199)['json'](_0x47b9b9);}else{_0x4f9056[_0x38ba47(0x14b)]=_0x38ba47(0x162)+_0x280744+_0x38ba47(0x169),_0x4f9056[_0x38ba47(0x165)]=_0x38ba47(0x14d),_0x590581=await salesforce[_0x38ba47(0x16f)](_0x4f9056[_0x38ba47(0x172)],_0x4f9056[_0x38ba47(0x177)],_0x4f9056[_0x38ba47(0x165)],_0x4f9056[_0x38ba47(0x159)],_0x4f9056[_0x38ba47(0x14b)]);if(!_0x590581){_0x47b9b9[_0x38ba47(0x165)]=_0x38ba47(0x164),console[_0x38ba47(0x175)](_0x38ba47(0x17e));try{await salesforce['updatePCScheduleStatus'](_0x280744,_0x26ddb6,SCHED_STATUSES['ERROR']);}catch(_0x219f1d){console[_0x38ba47(0x175)](_0x38ba47(0x168),_0x219f1d);}return _0x236d04['status'](0x1f4)[_0x38ba47(0x17a)](_0x47b9b9);}else{const _0x3e438a=await getPendingJobCount([..._0x3bb6cb,_0xaca272]);_0x3e438a?console[_0x38ba47(0x15b)]('Pending\x20jobs\x20were\x20detected,\x20the\x20policy\x20queue\x20will\x20not\x20be\x20resumed.'):(console['log']('No\x20pending\x20jobs\x20detected,\x20resuming\x20policy\x20queue.'),await _0x5112b4['resume'](![]));console[_0x38ba47(0x15b)](_0x38ba47(0x15c));const _0x5eb47c=await handleJobSubmission({'queue':_0x5112b4,'jobType':'policy-driver','jobData':{'executionId':_0x26ddb6,'policyName':_0x280744},'skipCounters':!![]});return _0x4f9056[_0x38ba47(0x14b)]='Policy:\x20'+_0x280744+_0x38ba47(0x16b),_0x4f9056[_0x38ba47(0x165)]=_0x38ba47(0x14d),_0x47b9b9[_0x38ba47(0x165)]=_0x4f9056[_0x38ba47(0x165)],_0x590581=await salesforce[_0x38ba47(0x16f)](_0x4f9056['executionId'],_0x4f9056[_0x38ba47(0x177)],_0x4f9056[_0x38ba47(0x165)],_0x4f9056[_0x38ba47(0x159)],_0x4f9056[_0x38ba47(0x14b)]),_0x236d04[_0x38ba47(0x165)](0xc8)[_0x38ba47(0x17a)](_0x47b9b9);}}}}};function a2_0x9e9c(_0x46ebb3,_0x214e2a){const _0x3a539d=a2_0x3a53();return a2_0x9e9c=function(_0x9e9cca,_0x3fcac4){_0x9e9cca=_0x9e9cca-0x147;let _0x2264a3=_0x3a539d[_0x9e9cca];return _0x2264a3;},a2_0x9e9c(_0x46ebb3,_0x214e2a);}module[a2_0x4b0c57(0x16a)]={'index':index,'authHeroku':authHeroku};
'use strict';const a35_0x54b7a1=a35_0x299f;function a35_0x299f(_0x1d93ee,_0x4443d1){const _0x2a3634=a35_0x2a36();return a35_0x299f=function(_0x299f0d,_0x3496bb){_0x299f0d=_0x299f0d-0x1d0;let _0x444075=_0x2a3634[_0x299f0d];return _0x444075;},a35_0x299f(_0x1d93ee,_0x4443d1);}(function(_0x1344c5,_0xd9de9b){const _0x2af165=a35_0x299f,_0x1c0de1=_0x1344c5();while(!![]){try{const _0x4a2f35=-parseInt(_0x2af165(0x1fb))/0x1*(parseInt(_0x2af165(0x1e9))/0x2)+parseInt(_0x2af165(0x1ef))/0x3*(parseInt(_0x2af165(0x1df))/0x4)+parseInt(_0x2af165(0x1d7))/0x5*(-parseInt(_0x2af165(0x1f8))/0x6)+parseInt(_0x2af165(0x1e5))/0x7*(-parseInt(_0x2af165(0x1f4))/0x8)+parseInt(_0x2af165(0x1fe))/0x9*(-parseInt(_0x2af165(0x200))/0xa)+parseInt(_0x2af165(0x1eb))/0xb*(parseInt(_0x2af165(0x1f5))/0xc)+parseInt(_0x2af165(0x1e6))/0xd*(parseInt(_0x2af165(0x1e4))/0xe);if(_0x4a2f35===_0xd9de9b)break;else _0x1c0de1['push'](_0x1c0de1['shift']());}catch(_0x5e314f){_0x1c0de1['push'](_0x1c0de1['shift']());}}}(a35_0x2a36,0x91b5d));function a35_0x2a36(){const _0x16c551=['header','log','organizationId','validateHerokuAuthHeader','redirectUri','2845bpKhCq','authCode','../settings','/oauth2/configure\x20received!','body','status','userInfo','jsforce','32232zBPmZa','instanceUrl','Authorization','OAuth2','express','26650484uOJDkQ','119tyYqrf','13SOKwfP','loginUrl','Unauthorized:\x20Missing\x20auth\x20header.','122jsCGCY','post','8965moEotR','Connection','/configure','Unauthorized:\x20Heroku\x20authentication\x20failed.','87nxcAqT','Access\x20token,\x20refresh\x20token,\x20instance\x20URL,\x20or\x20userInfo\x20object\x20were\x20not\x20obtained\x20from\x20OAuth\x20against\x20SF.\x20Something\x20is\x20wrong.','Missing\x20auth\x20header\x20on\x20/configure\x20request.','../models/queue','Error\x20attempting\x20to\x20authenticate\x20against\x20Salesforce\x20using\x20new\x20OAuth\x20credentials:\x20','145528juTQnQ','16752BchQTy','refreshToken','Submitting\x20update-cust-sf-oauth-vars\x20job.\x20SF_INSTANCE_URL\x20=>\x20','9942ycbBCm','error','json','9035EyDnmk','Unexpected\x20error:\x20','Error\x20setting\x20heroku\x20config\x20vars.\x20','48312yqgxKn','SF_INSTANCE_URL','1630JSyOGn','message','../controllers/worker/worker-utils/job-gateway','accessToken'];a35_0x2a36=function(){return _0x16c551;};return a35_0x2a36();}const express=require(a35_0x54b7a1(0x1e3));let router=express['Router']();const herokuModel=require('../models/heroku'),jsforce=require(a35_0x54b7a1(0x1de)),{sfApiVersion}=require(a35_0x54b7a1(0x1d9)),{handleJobSubmission}=require(a35_0x54b7a1(0x1d0)),{configQueue}=require(a35_0x54b7a1(0x1f2)),heroku=new herokuModel();router[a35_0x54b7a1(0x1ea)](a35_0x54b7a1(0x1ed),async function(_0x5be702,_0x5b915a){const _0x25aafc=a35_0x54b7a1;console[_0x25aafc(0x1d3)](_0x25aafc(0x1da));const _0x1eff44=_0x5be702[_0x25aafc(0x1d2)](_0x25aafc(0x1e1));if(!_0x1eff44)return console[_0x25aafc(0x1f9)](_0x25aafc(0x1f1)),_0x5b915a[_0x25aafc(0x1dc)](0x191)['json']({'error':_0x25aafc(0x1e8)});const _0x4835e8=await heroku[_0x25aafc(0x1d5)](_0x1eff44);if(!_0x4835e8)return console[_0x25aafc(0x1f9)]('Heroku\x20authentication\x20failed\x20on\x20/configure\x20request.'),_0x5b915a[_0x25aafc(0x1dc)](0x191)[_0x25aafc(0x1fa)]({'error':_0x25aafc(0x1ee)});console[_0x25aafc(0x1d3)]('Heroku\x20auth\x20was\x20successful!\x20Proceeding...'),console[_0x25aafc(0x1d3)](_0x5be702[_0x25aafc(0x1db)]);const _0x49c541=_0x5be702[_0x25aafc(0x1db)][_0x25aafc(0x1d8)],_0xc5b034=_0x5be702[_0x25aafc(0x1db)]['clientId'],_0xf57e2b=_0x5be702[_0x25aafc(0x1db)][_0x25aafc(0x1e7)],_0x6e314e=_0x5be702[_0x25aafc(0x1db)][_0x25aafc(0x1d6)],_0x12017f=new jsforce[(_0x25aafc(0x1e2))]({'loginUrl':_0xf57e2b,'clientId':_0xc5b034,'redirectUri':_0x6e314e}),_0x5e7427=new jsforce[(_0x25aafc(0x1ec))]({'oauth2':_0x12017f,'version':sfApiVersion});try{_0x5e7427['authorize'](_0x49c541,async function(_0xc983dd,_0x819905){const _0x44d5e1=_0x25aafc;if(_0xc983dd){console['error'](_0xc983dd),_0x5b915a['status'](0x191)['json']({'received':!![],'authSuccessful':![],'configVarsSet':![],'error':_0x44d5e1(0x1f3)+_0xc983dd[_0x44d5e1(0x201)]});return;}if(!_0x5e7427[_0x44d5e1(0x1d1)]||!_0x5e7427[_0x44d5e1(0x1f6)]||!_0x5e7427[_0x44d5e1(0x1e0)]||!_0x5e7427['userInfo']){const _0x1a9ed1=_0x44d5e1(0x1f0);console['error'](_0x1a9ed1),_0x5b915a[_0x44d5e1(0x1dc)](0x1f4)[_0x44d5e1(0x1fa)]({'received':!![],'authSuccessful':![],'configVarsSet':![],'error':_0x1a9ed1});return;}const _0x2029bc={'SF_LOGIN_URL':_0xf57e2b,'SF_CLIENT_ID':_0xc5b034,'SF_REDIRECT_URI':_0x6e314e,'SF_ACCESS_TOKEN':_0x5e7427[_0x44d5e1(0x1d1)],'SF_REFRESH_TOKEN':_0x5e7427['refreshToken'],'SF_INSTANCE_URL':_0x5e7427[_0x44d5e1(0x1e0)],'SF_LONG_ORG_ID':_0x5e7427[_0x44d5e1(0x1dd)][_0x44d5e1(0x1d4)],'SF_USER_ID':_0x5e7427[_0x44d5e1(0x1dd)]['id']};try{console[_0x44d5e1(0x1d3)](_0x44d5e1(0x1f7)+_0x2029bc[_0x44d5e1(0x1ff)]),await handleJobSubmission({'queue':configQueue,'jobType':'update-cust-sf-oauth-vars','jobData':{'tokenInfo':_0x2029bc},'skipCounters':!![]}),_0x5b915a[_0x44d5e1(0x1dc)](0xc8)[_0x44d5e1(0x1fa)]({'received':!![],'authSuccessful':!![],'configVarsSet':!![]});return;}catch(_0xa85ad1){const _0x287173=_0x44d5e1(0x1fd)+_0xa85ad1['message'];console[_0x44d5e1(0x1f9)](_0x287173),_0x5b915a[_0x44d5e1(0x1dc)](0x1f4)[_0x44d5e1(0x1fa)]({'received':!![],'authSuccessful':!![],'configVarsSet':![],'error':_0x287173});return;}});}catch(_0x353140){console[_0x25aafc(0x1f9)](_0x353140),_0x5b915a[_0x25aafc(0x1dc)](0x1f4)['json']({'received':!![],'authSuccessful':![],'configVarsSet':![],'error':_0x25aafc(0x1fc)+_0x353140['message']});return;}}),module['exports']=router;